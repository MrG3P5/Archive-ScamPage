window.addEventListener||(Window.prototype.addEventListener=function(e,g){return this.attachEvent("on"+e,g)});var KeyValueStore=function(){this.cache={}};KeyValueStore.prototype.set=function(e,g){this.cache[e]=g};KeyValueStore.prototype.get=function(e){return this.cache.hasOwnProperty(e)?this.cache[e]:null};
(function(e,g){function n(a,b,d){null!=a&&("number"==typeof a?this.fromNumber(a,b,d):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function q(){return new n(null)}function t(a,b,d,k,c,f){for(;0<=--f;){var h=b*this[a++]+d[k]+c;c=Math.floor(h/67108864);d[k++]=h&67108863}return c}function F(a,b,d,k,c,f){var h=b&32767;for(b>>=15;0<=--f;){var e=this[a]&32767,ea=this[a++]>>15,g=b*e+ea*h,e=h*e+((g&32767)<<15)+d[k]+(c&1073741823);c=(e>>>30)+(g>>>15)+b*ea+(c>>>30);d[k++]=e&1073741823}return c}
function K(a,b,d,k,c,f){var h=b&16383;for(b>>=14;0<=--f;){var e=this[a]&16383,g=this[a++]>>14,l=b*e+g*h,e=h*e+((l&16383)<<14)+d[k]+c;c=(e>>28)+(l>>14)+b*g;d[k++]=e&268435455}return c}function H(a){var b=q();b.fromInt(a);return b}function I(a){var b=1,d;0!=(d=a>>>16)&&(a=d,b+=16);0!=(d=a>>8)&&(a=d,b+=8);0!=(d=a>>4)&&(a=d,b+=4);0!=(d=a>>2)&&(a=d,b+=2);0!=a>>1&&(b+=1);return b}function G(a){this.m=a}function J(a){this.m=a;this.mp=a.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<a.DB-
15)-1;this.mt2=2*a.t}function M(){this.j=this.i=0;this.S=[]}function T(a){A[u++]^=a&255;A[u++]^=a>>8&255;A[u++]^=a>>16&255;A[u++]^=a>>24&255;256<=u&&(u-=256)}function z(){}function N(){this.n=null;this.e=0;this.coeff=this.dmq1=this.dmp1=this.q=this.p=this.d=null}function x(a){throw a;}function ba(a,b,d){4!==b.length&&x(new l.exception.invalid("invalid aes block size"));var k=a.b[d],c=b[0]^k[0],f=b[d?3:1]^k[1],h=b[2]^k[2];b=b[d?1:3]^k[3];var e,g,m,n=k.length/4-2,w,y=4,q=[0,0,0,0];e=a.k[d];a=e[0];var r=
e[1],s=e[2],t=e[3],u=e[4];for(w=0;w<n;w++)e=a[c>>>24]^r[f>>16&255]^s[h>>8&255]^t[b&255]^k[y],g=a[f>>>24]^r[h>>16&255]^s[b>>8&255]^t[c&255]^k[y+1],m=a[h>>>24]^r[b>>16&255]^s[c>>8&255]^t[f&255]^k[y+2],b=a[b>>>24]^r[c>>16&255]^s[f>>8&255]^t[h&255]^k[y+3],y+=4,c=e,f=g,h=m;for(w=0;4>w;w++)q[d?3&-w:w]=u[c>>>24]<<24^u[f>>16&255]<<16^u[h>>8&255]<<8^u[b&255]^k[y++],e=c,c=f,f=h,h=b,b=e;return q}function O(a,b){var d,k,c,f=b.slice(0),h=a.r,e=a.b,g=h[0],l=h[1],m=h[2],n=h[3],y=h[4],q=h[5],r=h[6],s=h[7];for(d=
0;64>d;d++)16>d?k=f[d]:(k=f[d+1&15],c=f[d+14&15],k=f[d&15]=(k>>>7^k>>>18^k>>>3^k<<25^k<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+f[d&15]+f[d+9&15]|0),k=k+s+(y>>>6^y>>>11^y>>>25^y<<26^y<<21^y<<7)+(r^y&(q^r))+e[d],s=r,r=q,q=y,y=n+k|0,n=m,m=l,l=g,g=k+(l&m^n&(l^m))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;h[0]=h[0]+g|0;h[1]=h[1]+l|0;h[2]=h[2]+m|0;h[3]=h[3]+n|0;h[4]=h[4]+y|0;h[5]=h[5]+q|0;h[6]=h[6]+r|0;h[7]=h[7]+s|0}function ca(a,b){var d,k=l.random.w[a],c=[];for(d in k)k.hasOwnProperty(d)&&c.push(k[d]);
for(d=0;d<c.length;d++)c[d](b)}function U(a){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?l.random.addEntropy(window.performance.now(),a,"loadtime"):l.random.addEntropy((new Date).valueOf(),a,"loadtime")}function Y(a){a.b=Q(a).concat(Q(a));a.A=new l.cipher.aes(a.b)}function Q(a){for(var b=0;4>b&&(a.f[b]=a.f[b]+1|0,!a.f[b]);b++);return a.A.encrypt(a.f)}function aa(a,b){return function(){b.apply(a,arguments)}}(function(){function a(a,b){return this.slice(a,
b)}function b(a,b){2>arguments.length&&(b=0);for(var d=0,k=a.length;d<k;++d,++b)this[b]=a[d]&255}function d(d){var k;if("number"===typeof d){k=Array(d);for(var c=0;c<d;++c)k[c]=0}else k=d.slice(0);k.subarray=a;k.buffer=k;k.byteLength=k.length;k.set=b;"object"===typeof d&&d.buffer&&(k.buffer=d.buffer);return k}try{new Uint8Array(1);new Uint32Array(1);new Int32Array(1);return}catch(k){}try{window.Uint8Array=d}catch(c){}try{window.Uint32Array=d}catch(f){}try{window.Int32Array=d}catch(h){}})();(function(){try{"undefined"===
typeof window||"btoa"in window||(window.btoa=function(a){var d="",k,c;k=0;for(c=a.length;k<c;k+=3)var f=a.charCodeAt(k)&255,h=a.charCodeAt(k+1)&255,e=a.charCodeAt(k+2)&255,g=(f&3)<<4|h>>4,h=k+1<c?(h&15)<<2|e>>6:64,e=k+2<c?e&63:64,d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e));
return d})}catch(a){}})();var B;"Microsoft Internet Explorer"==navigator.appName?(n.prototype.am=F,B=30):"Netscape"!=navigator.appName?(n.prototype.am=t,B=26):(n.prototype.am=K,B=28);n.prototype.DB=B;n.prototype.DM=(1<<B)-1;n.prototype.DV=1<<B;n.prototype.FV=Math.pow(2,52);n.prototype.F1=52-B;n.prototype.F2=2*B-52;var R=[],C;B=48;for(C=0;9>=C;++C)R[B++]=C;B=97;for(C=10;36>C;++C)R[B++]=C;B=65;for(C=10;36>C;++C)R[B++]=C;G.prototype.convert=function(a){return 0>a.s||0<=a.compareTo(this.m)?a.mod(this.m):
a};G.prototype.revert=function(a){return a};G.prototype.reduce=function(a){a.divRemTo(this.m,null,a)};G.prototype.mulTo=function(a,b,d){a.multiplyTo(b,d);this.reduce(d)};G.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};J.prototype.convert=function(a){var b=q();a.abs().dlShiftTo(this.m.t,b);b.divRemTo(this.m,null,b);0>a.s&&0<b.compareTo(n.ZERO)&&this.m.subTo(b,b);return b};J.prototype.revert=function(a){var b=q();a.copyTo(b);this.reduce(b);return b};J.prototype.reduce=function(a){for(;a.t<=
this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var d=a[b]&32767,k=d*this.mpl+((d*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM,d=b+this.m.t;for(a[d]+=this.m.am(0,k,a,b,0,this.m.t);a[d]>=a.DV;)a[d]-=a.DV,a[++d]++}a.clamp();a.drShiftTo(this.m.t,a);0<=a.compareTo(this.m)&&a.subTo(this.m,a)};J.prototype.mulTo=function(a,b,d){a.multiplyTo(b,d);this.reduce(d)};J.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};n.prototype.copyTo=function(a){for(var b=this.t-1;0<=b;--b)a[b]=this[b];a.t=this.t;
a.s=this.s};n.prototype.fromInt=function(a){this.t=1;this.s=0>a?-1:0;0<a?this[0]=a:-1>a?this[0]=a+this.DV:this.t=0};n.prototype.fromString=function(a,b){var d;if(16==b)d=4;else if(8==b)d=3;else if(256==b)d=8;else if(2==b)d=1;else if(32==b)d=5;else if(4==b)d=2;else{this.fromRadix(a,b);return}this.s=this.t=0;for(var k=a.length,c=!1,f=0;0<=--k;){var h;8==d?h=a[k]&255:(h=R[a.charCodeAt(k)],h=null==h?-1:h);0>h?"-"==a.charAt(k)&&(c=!0):(c=!1,0==f?this[this.t++]=h:f+d>this.DB?(this[this.t-1]|=(h&(1<<this.DB-
f)-1)<<f,this[this.t++]=h>>this.DB-f):this[this.t-1]|=h<<f,f+=d,f>=this.DB&&(f-=this.DB))}8==d&&0!=(a[0]&128)&&(this.s=-1,0<f&&(this[this.t-1]|=(1<<this.DB-f)-1<<f));this.clamp();c&&n.ZERO.subTo(this,this)};n.prototype.clamp=function(){for(var a=this.s&this.DM;0<this.t&&this[this.t-1]==a;)--this.t};n.prototype.dlShiftTo=function(a,b){var d;for(d=this.t-1;0<=d;--d)b[d+a]=this[d];for(d=a-1;0<=d;--d)b[d]=0;b.t=this.t+a;b.s=this.s};n.prototype.drShiftTo=function(a,b){for(var d=a;d<this.t;++d)b[d-a]=this[d];
b.t=Math.max(this.t-a,0);b.s=this.s};n.prototype.lShiftTo=function(a,b){var d=a%this.DB,k=this.DB-d,c=(1<<k)-1,f=Math.floor(a/this.DB),h=this.s<<d&this.DM,e;for(e=this.t-1;0<=e;--e)b[e+f+1]=this[e]>>k|h,h=(this[e]&c)<<d;for(e=f-1;0<=e;--e)b[e]=0;b[f]=h;b.t=this.t+f+1;b.s=this.s;b.clamp()};n.prototype.rShiftTo=function(a,b){b.s=this.s;var d=Math.floor(a/this.DB);if(d>=this.t)b.t=0;else{var k=a%this.DB,c=this.DB-k,f=(1<<k)-1;b[0]=this[d]>>k;for(var h=d+1;h<this.t;++h)b[h-d-1]|=(this[h]&f)<<c,b[h-d]=
this[h]>>k;0<k&&(b[this.t-d-1]|=(this.s&f)<<c);b.t=this.t-d;b.clamp()}};n.prototype.subTo=function(a,b){for(var d=0,k=0,c=Math.min(a.t,this.t);d<c;)k+=this[d]-a[d],b[d++]=k&this.DM,k>>=this.DB;if(a.t<this.t){for(k-=a.s;d<this.t;)k+=this[d],b[d++]=k&this.DM,k>>=this.DB;k+=this.s}else{for(k+=this.s;d<a.t;)k-=a[d],b[d++]=k&this.DM,k>>=this.DB;k-=a.s}b.s=0>k?-1:0;-1>k?b[d++]=this.DV+k:0<k&&(b[d++]=k);b.t=d;b.clamp()};n.prototype.multiplyTo=function(a,b){var d=this.abs(),k=a.abs(),c=d.t;for(b.t=c+k.t;0<=
--c;)b[c]=0;for(c=0;c<k.t;++c)b[c+d.t]=d.am(0,k[c],b,c,0,d.t);b.s=0;b.clamp();this.s!=a.s&&n.ZERO.subTo(b,b)};n.prototype.squareTo=function(a){for(var b=this.abs(),d=a.t=2*b.t;0<=--d;)a[d]=0;for(d=0;d<b.t-1;++d){var k=b.am(d,b[d],a,2*d,0,1);(a[d+b.t]+=b.am(d+1,2*b[d],a,2*d+1,k,b.t-d-1))>=b.DV&&(a[d+b.t]-=b.DV,a[d+b.t+1]=1)}0<a.t&&(a[a.t-1]+=b.am(d,b[d],a,2*d,0,1));a.s=0;a.clamp()};n.prototype.divRemTo=function(a,b,d){var k=a.abs();if(!(0>=k.t)){var c=this.abs();if(c.t<k.t)null!=b&&b.fromInt(0),null!=
d&&this.copyTo(d);else{null==d&&(d=q());var f=q(),h=this.s;a=a.s;var e=this.DB-I(k[k.t-1]);0<e?(k.lShiftTo(e,f),c.lShiftTo(e,d)):(k.copyTo(f),c.copyTo(d));k=f.t;c=f[k-1];if(0!=c){var g=c*(1<<this.F1)+(1<k?f[k-2]>>this.F2:0),l=this.FV/g,g=(1<<this.F1)/g,m=1<<this.F2,w=d.t,y=w-k,r=null==b?q():b;f.dlShiftTo(y,r);0<=d.compareTo(r)&&(d[d.t++]=1,d.subTo(r,d));n.ONE.dlShiftTo(k,r);for(r.subTo(f,f);f.t<k;)f[f.t++]=0;for(;0<=--y;){var s=d[--w]==c?this.DM:Math.floor(d[w]*l+(d[w-1]+m)*g);if((d[w]+=f.am(0,s,
d,y,0,k))<s)for(f.dlShiftTo(y,r),d.subTo(r,d);d[w]<--s;)d.subTo(r,d)}null!=b&&(d.drShiftTo(k,b),h!=a&&n.ZERO.subTo(b,b));d.t=k;d.clamp();0<e&&d.rShiftTo(e,d);0>h&&n.ZERO.subTo(d,d)}}}};n.prototype.invDigit=function(){if(1>this.t)return 0;var a=this[0];if(0==(a&1))return 0;var b=a&3,b=b*(2-(a&15)*b)&15,b=b*(2-(a&255)*b)&255,b=b*(2-((a&65535)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV;return 0<b?this.DV-b:-b};n.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};n.prototype.exp=function(a,
b){if(4294967295<a||1>a)return n.ONE;var d=q(),k=q(),c=b.convert(this),f=I(a)-1;for(c.copyTo(d);0<=--f;)if(b.sqrTo(d,k),0<(a&1<<f))b.mulTo(k,c,d);else var h=d,d=k,k=h;return b.revert(d)};n.prototype.toString=function(a){if(0>this.s)return"-"+this.negate().toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else if(4==a)a=2;else return this.toRadix(a);var b=(1<<a)-1,d,k=!1,c="",f=this.t,h=this.DB-f*this.DB%a;if(0<f--)for(h<this.DB&&0<(d=this[f]>>h)&&(k=!0,c="0123456789abcdefghijklmnopqrstuvwxyz".charAt(d));0<=
f;)h<a?(d=(this[f]&(1<<h)-1)<<a-h,d|=this[--f]>>(h+=this.DB-a)):(d=this[f]>>(h-=a)&b,0>=h&&(h+=this.DB,--f)),0<d&&(k=!0),k&&(c+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(d));return k?c:"0"};n.prototype.negate=function(){var a=q();n.ZERO.subTo(this,a);return a};n.prototype.abs=function(){return 0>this.s?this.negate():this};n.prototype.compareTo=function(a){var b=this.s-a.s;if(0!=b)return b;var d=this.t,b=d-a.t;if(0!=b)return 0>this.s?-b:b;for(;0<=--d;)if(0!=(b=this[d]-a[d]))return b;return 0};
n.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+I(this[this.t-1]^this.s&this.DM)};n.prototype.mod=function(a){var b=q();this.abs().divRemTo(a,null,b);0>this.s&&0<b.compareTo(n.ZERO)&&a.subTo(b,b);return b};n.prototype.modPowInt=function(a,b){var d;d=256>a||b.isEven()?new G(b):new J(b);return this.exp(a,d)};n.ZERO=H(0);n.ONE=H(1);M.prototype.init=function(a){var b,d,k;for(b=0;256>b;++b)this.S[b]=b;for(b=d=0;256>b;++b)d=d+this.S[b]+a[b%a.length]&255,k=this.S[b],this.S[b]=this.S[d],
this.S[d]=k;this.j=this.i=0};M.prototype.next=function(){var a;this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;a=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=a;return this.S[a+this.S[this.i]&255]};var S,A,u;if(null==A){A=[];u=0;var r;try{if(window.crypto&&window.crypto.getRandomValues){var E=new Uint8Array(32);window.crypto.getRandomValues(E);for(r=0;32>r;++r)A[u++]=E[r]}else if(window.msCrypto&&window.msCrypto.getRandomValues)for(E=new Uint8Array(32),window.msCrypto.getRandomValues(E),
r=0;32>r;++r)A[u++]=E[r];else if(window.crypto&&window.crypto.random)for(O=window.crypto.random(32),r=0;r<O.length;++r)A[u++]=O.charCodeAt(r)&255}catch(ga){}for(;256>u;)r=Math.floor(65536*Math.random()),A[u++]=r>>>8,A[u++]=r&255;u=0;T((new Date).getTime())}z.prototype.nextBytes=function(a){var b;for(b=0;b<a.length;++b){var d=b,k;if(null==S){T((new Date).getTime());S=new M;S.init(A);for(u=0;u<A.length;++u)A[u]=0;u=0}k=S.next();a[d]=k}};N.prototype.doPublic=function(a){return a.modPowInt(this.e,this.n)};
N.prototype.setPublic=function(a,b){null!=a&&null!=b&&0<a.length&&0<b.length?(this.n=new n(a,16),this.e=parseInt(b,16)):alert("Invalid RSA public key")};N.prototype.encrypt=function(a){var b;b=this.n.bitLength()+7>>3;if(b<a.length+11)alert("Message too long for RSA"),b=null;else{for(var d=[],k=a.length-1;0<=k&&0<b;)d[--b]=a[k--];d[--b]=0;a=new z;for(k=[];2<b;){for(k[0]=0;0==k[0];)a.nextBytes(k);d[--b]=k[0]}d[--b]=2;d[--b]=0;b=new n(d)}if(null==b)return null;b=this.doPublic(b);if(null==b)return null;
b=b.toString(16);return 0==(b.length&1)?b:"0"+b};N.prototype.encrypt_b64=function(a){if(a=this.encrypt(a)){var b,d,k="";for(b=0;b+3<=a.length;b+=3)d=parseInt(a.substring(b,b+3),16),k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d&63);b+1==a.length?(d=parseInt(a.substring(b,b+1),16),k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d<<2)):b+2==a.length&&(d=parseInt(a.substring(b,
b+2),16),k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((d&3)<<4));for(;0<(k.length&3);)k+="\x3d";return k}return null};"use strict";r=void 0;var l={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=
a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};"undefined"!==typeof module&&module.exports&&(module.exports=l);l.cipher.aes=function(a){this.k[0][0][0]||this.D();var b,d,k,c,f=this.k[0][4],h=this.k[1];b=a.length;var e=1;4!==b&&6!==b&&8!==b&&x(new l.exception.invalid("invalid aes key size"));this.b=[k=a.slice(0),c=[]];for(a=b;a<4*b+28;a++){d=k[a-1];if(0===a%b||
8===b&&4===a%b)d=f[d>>>24]<<24^f[d>>16&255]<<16^f[d>>8&255]<<8^f[d&255],0===a%b&&(d=d<<8^d>>>24^e<<24,e=e<<1^283*(e>>7));k[a]=k[a-b]^d}for(b=0;a;b++,a--)d=k[b&3?a:a-4],c[b]=4>=a||4>b?d:h[0][f[d>>>24]]^h[1][f[d>>16&255]]^h[2][f[d>>8&255]]^h[3][f[d&255]]};l.cipher.aes.prototype={encrypt:function(a){return ba(this,a,0)},decrypt:function(a){return ba(this,a,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var a=this.k[0],b=this.k[1],d=a[4],k=b[4],c,f,h,e=[],g=[],l,m,n,y;for(c=0;256>c;c++)g[(e[c]=
c<<1^283*(c>>7))^c]=c;for(f=h=0;!d[f];f^=l||1,h=g[h]||1)for(n=h^h<<1^h<<2^h<<3^h<<4,n=n>>8^n&255^99,d[f]=n,k[n]=f,m=e[c=e[l=e[f]]],y=16843009*m^65537*c^257*l^16843008*f,m=257*e[n]^16843008*n,c=0;4>c;c++)a[c][f]=m=m<<24^m>>>8,b[c][n]=y=y<<24^y>>>8;for(c=0;5>c;c++)a[c]=a[c].slice(0),b[c]=b[c].slice(0)}};l.bitArray={bitSlice:function(a,b,d){a=l.bitArray.P(a.slice(b/32),32-(b&31)).slice(1);return d===r?a:l.bitArray.clamp(a,d-b)},extract:function(a,b,d){var k=Math.floor(-b-d&31);return((b+d-1^b)&-32?a[b/
32|0]<<32-k^a[b/32+1|0]>>>k:a[b/32|0]>>>k)&(1<<d)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var d=a[a.length-1],k=l.bitArray.getPartial(d);return 32===k?a.concat(b):l.bitArray.P(b,k,d|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+l.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var d=a.length;b&=31;0<d&&b&&(a[d-1]=l.bitArray.partial(b,a[d-1]&2147483648>>b-1,1));return a},
partial:function(a,b,d){return 32===a?b:(d?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(l.bitArray.bitLength(a)!==l.bitArray.bitLength(b))return!1;var d=0,k;for(k=0;k<a.length;k++)d|=a[k]^b[k];return 0===d},P:function(a,b,d,k){var c;for(k===r&&(k=[]);32<=b;b-=32)k.push(d),d=0;if(0===b)return k.concat(a);for(c=0;c<a.length;c++)k.push(d|a[c]>>>b),d=a[c]<<32-b;c=a.length?a[a.length-1]:0;a=l.bitArray.getPartial(c);k.push(l.bitArray.partial(b+
a&31,32<b+a?d:k.pop(),1));return k},l:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,d;for(b=0;b<a.length;++b)d=a[b],a[b]=d>>>24|d>>>8&65280|(d&65280)<<8|d<<24;return a}};l.codec.utf8String={fromBits:function(a){var b="",d=l.bitArray.bitLength(a),k,c;for(k=0;k<d/8;k++)0===(k&3)&&(c=a[k/4]),b+=String.fromCharCode(c>>>24),c<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],d,c=0;for(d=0;d<a.length;d++)c=
c<<8|a.charCodeAt(d),3===(d&3)&&(b.push(c),c=0);d&3&&b.push(l.bitArray.partial(8*(d&3),c));return b}};l.codec.hex={fromBits:function(a){var b="",d;for(d=0;d<a.length;d++)b+=((a[d]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,l.bitArray.bitLength(a)/4)},toBits:function(a){var b,d=[],c;a=a.replace(/\s|0x/g,"");c=a.length;a+="00000000";for(b=0;b<a.length;b+=8)d.push(parseInt(a.substr(b,8),16)^0);return l.bitArray.clamp(d,4*c)}};l.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
fromBits:function(a,b,d){var c="",p=0,f=l.codec.base64.J,h=0,e=l.bitArray.bitLength(a);d&&(f=f.substr(0,62)+"-_");for(d=0;6*c.length<e;)c+=f.charAt((h^a[d]>>>p)>>>26),6>p?(h=a[d]<<6-p,p+=26,d++):(h<<=6,p-=6);for(;c.length&3&&!b;)c+="\x3d";return c},toBits:function(a,b){a=a.replace(/\s|=/g,"");var d=[],c,p=0,f=l.codec.base64.J,h=0,e;b&&(f=f.substr(0,62)+"-_");for(c=0;c<a.length;c++)e=f.indexOf(a.charAt(c)),0>e&&x(new l.exception.invalid("this isn't base64!")),26<p?(p-=26,d.push(h^e>>>p),h=e<<32-p):
(p+=6,h^=e<<32-p);p&56&&d.push(l.bitArray.partial(p&56,h,1));return d}};l.codec.base64url={fromBits:function(a){return l.codec.base64.fromBits(a,1,1)},toBits:function(a){return l.codec.base64.toBits(a,1)}};l.hash.sha256=function(a){this.b[0]||this.D();a?(this.r=a.r.slice(0),this.o=a.o.slice(0),this.h=a.h):this.reset()};l.hash.sha256.hash=function(a){return(new l.hash.sha256).update(a).finalize()};l.hash.sha256.prototype={blockSize:512,reset:function(){this.r=this.N.slice(0);this.o=[];this.h=0;return this},
update:function(a){"string"===typeof a&&(a=l.codec.utf8String.toBits(a));var b,d=this.o=l.bitArray.concat(this.o,a);b=this.h;a=this.h=b+l.bitArray.bitLength(a);for(b=512+b&-512;b<=a;b+=512)O(this,d.splice(0,16));return this},finalize:function(){var a,b=this.o,d=this.r,b=l.bitArray.concat(b,[l.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.h/4294967296));for(b.push(this.h|0);b.length;)O(this,b.splice(0,16));this.reset();return d},N:[],b:[],D:function(){function a(a){return 4294967296*
(a-Math.floor(a))|0}var b=0,d=2,c;a:for(;64>b;d++){for(c=2;c*c<=d;c++)if(0===d%c)continue a;8>b&&(this.N[b]=a(Math.pow(d,.5)));this.b[b]=a(Math.pow(d,1/3));b++}}};l.mode.ccm={name:"ccm",encrypt:function(a,b,d,c,p){var f,h=b.slice(0),e=l.bitArray,g=e.bitLength(d)/8,m=e.bitLength(h)/8;p=p||64;c=c||[];7>g&&x(new l.exception.invalid("ccm: iv must be at least 7 bytes"));for(f=2;4>f&&m>>>8*f;f++);f<15-g&&(f=15-g);d=e.clamp(d,8*(15-f));b=l.mode.ccm.L(a,b,d,c,p,f);h=l.mode.ccm.p(a,h,d,b,p,f);return e.concat(h.data,
h.tag)},decrypt:function(a,b,d,c,p){p=p||64;c=c||[];var f=l.bitArray,h=f.bitLength(d)/8,e=f.bitLength(b),g=f.clamp(b,e-p),m=f.bitSlice(b,e-p),e=(e-p)/8;7>h&&x(new l.exception.invalid("ccm: iv must be at least 7 bytes"));for(b=2;4>b&&e>>>8*b;b++);b<15-h&&(b=15-h);d=f.clamp(d,8*(15-b));g=l.mode.ccm.p(a,g,d,m,p,b);a=l.mode.ccm.L(a,g.data,d,c,p,b);f.equal(g.tag,a)||x(new l.exception.corrupt("ccm: tag doesn't match"));return g.data},L:function(a,b,d,c,p,f){var h=[],e=l.bitArray,g=e.l;p/=8;(p%2||4>p||16<
p)&&x(new l.exception.invalid("ccm: invalid tag length"));(4294967295<c.length||4294967295<b.length)&&x(new l.exception.bug("ccm: can't deal with 4GiB or more data"));f=[e.partial(8,(c.length?64:0)|p-2<<2|f-1)];f=e.concat(f,d);f[3]|=e.bitLength(b)/8;f=a.encrypt(f);if(c.length)for(d=e.bitLength(c)/8,65279>=d?h=[e.partial(16,d)]:4294967295>=d&&(h=e.concat([e.partial(16,65534)],[d])),h=e.concat(h,c),c=0;c<h.length;c+=4)f=a.encrypt(g(f,h.slice(c,c+4).concat([0,0,0])));for(c=0;c<b.length;c+=4)f=a.encrypt(g(f,
b.slice(c,c+4).concat([0,0,0])));return e.clamp(f,8*p)},p:function(a,b,d,c,p,f){var h,e=l.bitArray;h=e.l;var g=b.length,m=e.bitLength(b);d=e.concat([e.partial(8,f-1)],d).concat([0,0,0]).slice(0,4);c=e.bitSlice(h(c,a.encrypt(d)),0,p);if(!g)return{tag:c,data:[]};for(h=0;h<g;h+=4)d[3]++,p=a.encrypt(d),b[h]^=p[0],b[h+1]^=p[1],b[h+2]^=p[2],b[h+3]^=p[3];return{tag:c,data:e.clamp(b,m)}}};l.mode.ocb2={name:"ocb2",encrypt:function(a,b,d,c,p,f){128!==l.bitArray.bitLength(d)&&x(new l.exception.invalid("ocb iv must be 128 bits"));
var h,e=l.mode.ocb2.H,g=l.bitArray,m=g.l,n=[0,0,0,0];d=e(a.encrypt(d));var w,y=[];c=c||[];p=p||64;for(h=0;h+4<b.length;h+=4)w=b.slice(h,h+4),n=m(n,w),y=y.concat(m(d,a.encrypt(m(d,w)))),d=e(d);w=b.slice(h);b=g.bitLength(w);h=a.encrypt(m(d,[0,0,0,b]));w=g.clamp(m(w.concat([0,0,0]),h),b);n=m(n,m(w.concat([0,0,0]),h));n=a.encrypt(m(n,m(d,e(d))));c.length&&(n=m(n,f?c:l.mode.ocb2.pmac(a,c)));return y.concat(g.concat(w,g.clamp(n,p)))},decrypt:function(a,b,d,c,p,f){128!==l.bitArray.bitLength(d)&&x(new l.exception.invalid("ocb iv must be 128 bits"));
p=p||64;var h=l.mode.ocb2.H,e=l.bitArray,g=e.l,m=[0,0,0,0],n=h(a.encrypt(d)),w,y,q=l.bitArray.bitLength(b)-p,r=[];c=c||[];for(d=0;d+4<q/32;d+=4)w=g(n,a.decrypt(g(n,b.slice(d,d+4)))),m=g(m,w),r=r.concat(w),n=h(n);y=q-32*d;w=a.encrypt(g(n,[0,0,0,y]));w=g(w,e.clamp(b.slice(d),y).concat([0,0,0]));m=g(m,w);m=a.encrypt(g(m,g(n,h(n))));c.length&&(m=g(m,f?c:l.mode.ocb2.pmac(a,c)));e.equal(e.clamp(m,p),e.bitSlice(b,q))||x(new l.exception.corrupt("ocb: tag doesn't match"));return r.concat(e.clamp(w,y))},pmac:function(a,
b){var d,c=l.mode.ocb2.H,p=l.bitArray,f=p.l,h=[0,0,0,0],e=a.encrypt([0,0,0,0]),e=f(e,c(c(e)));for(d=0;d+4<b.length;d+=4)e=c(e),h=f(h,a.encrypt(f(e,b.slice(d,d+4))));d=b.slice(d);128>p.bitLength(d)&&(e=f(e,c(e)),d=p.concat(d,[-2147483648,0,0,0]));h=f(h,d);return a.encrypt(f(c(f(e,c(e))),h))},H:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};l.mode.gcm={name:"gcm",encrypt:function(a,b,d,c,p){var f=b.slice(0);b=l.bitArray;c=c||[];a=l.mode.gcm.p(!0,
a,f,c,d,p||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,d,c,p){var f=b.slice(0),h=l.bitArray,e=h.bitLength(f);p=p||128;c=c||[];p<=e?(b=h.bitSlice(f,e-p),f=h.bitSlice(f,0,e-p)):(b=f,f=[]);a=l.mode.gcm.p(!1,a,f,c,d,p);h.equal(a.tag,b)||x(new l.exception.corrupt("gcm: tag doesn't match"));return a.data},Z:function(a,b){var d,c,p,f,h,e=l.bitArray.l;p=[0,0,0,0];f=b.slice(0);for(d=0;128>d;d++){0!==(a[Math.floor(d/32)]&1<<31-d%32)&&(p=e(p,f));h=0!==(f[3]&1);for(c=3;0<c;c--)f[c]=f[c]>>>1|(f[c-
1]&1)<<31;f[0]>>>=1;h&&(f[0]^=-520093696)}return p},g:function(a,b,d){var c,p=d.length;b=b.slice(0);for(c=0;c<p;c+=4)b[0]^=4294967295&d[c],b[1]^=4294967295&d[c+1],b[2]^=4294967295&d[c+2],b[3]^=4294967295&d[c+3],b=l.mode.gcm.Z(b,a);return b},p:function(a,b,d,c,p,f){var h,e,g,m,n,w,y,q,r=l.bitArray;w=d.length;y=r.bitLength(d);q=r.bitLength(c);e=r.bitLength(p);h=b.encrypt([0,0,0,0]);96===e?(p=p.slice(0),p=r.concat(p,[1])):(p=l.mode.gcm.g(h,[0,0,0,0],p),p=l.mode.gcm.g(h,p,[0,0,Math.floor(e/4294967296),
e&4294967295]));e=l.mode.gcm.g(h,[0,0,0,0],c);n=p.slice(0);c=e.slice(0);a||(c=l.mode.gcm.g(h,e,d));for(m=0;m<w;m+=4)n[3]++,g=b.encrypt(n),d[m]^=g[0],d[m+1]^=g[1],d[m+2]^=g[2],d[m+3]^=g[3];d=r.clamp(d,y);a&&(c=l.mode.gcm.g(h,e,d));a=[Math.floor(q/4294967296),q&4294967295,Math.floor(y/4294967296),y&4294967295];c=l.mode.gcm.g(h,c,a);g=b.encrypt(p);c[0]^=g[0];c[1]^=g[1];c[2]^=g[2];c[3]^=g[3];return{tag:r.bitSlice(c,0,f),data:d}}};l.misc.hmac=function(a,b){this.M=b=b||l.hash.sha256;var d=[[],[]],c,p=b.prototype.blockSize/
32;this.n=[new b,new b];a.length>p&&(a=b.hash(a));for(c=0;c<p;c++)d[0][c]=a[c]^909522486,d[1][c]=a[c]^1549556828;this.n[0].update(d[0]);this.n[1].update(d[1]);this.G=new b(this.n[0])};l.misc.hmac.prototype.encrypt=l.misc.hmac.prototype.mac=function(a){this.Q&&x(new l.exception.invalid("encrypt on already updated hmac called!"));this.update(a);return this.digest(a)};l.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]);this.Q=!1};l.misc.hmac.prototype.update=function(a){this.Q=!0;this.G.update(a)};
l.misc.hmac.prototype.digest=function(){var a=this.G.finalize(),a=(new this.M(this.n[1])).update(a).finalize();this.reset();return a};l.misc.pbkdf2=function(a,b,d,c,p){d=d||1E3;(0>c||0>d)&&x(l.exception.invalid("invalid params to pbkdf2"));"string"===typeof a&&(a=l.codec.utf8String.toBits(a));"string"===typeof b&&(b=l.codec.utf8String.toBits(b));p=p||l.misc.hmac;a=new p(a);var f,h,e,g,m=[],n=l.bitArray;for(g=1;32*m.length<(c||1);g++){p=f=a.encrypt(n.concat(b,[g]));for(h=1;h<d;h++)for(f=a.encrypt(f),
e=0;e<f.length;e++)p[e]^=f[e];m=m.concat(p)}c&&(m=n.clamp(m,c));return m};l.prng=function(a){this.c=[new l.hash.sha256];this.i=[0];this.F=0;this.s={};this.C=0;this.K={};this.O=this.d=this.j=this.W=0;this.b=[0,0,0,0,0,0,0,0];this.f=[0,0,0,0];this.A=r;this.B=a;this.q=!1;this.w={progress:{},seeded:{}};this.m=this.V=0;this.t=1;this.u=2;this.S=65536;this.I=[0,48,64,96,128,192,256,384,512,768,1024];this.T=3E4;this.R=80};l.prng.prototype={randomWords:function(a,b){var d=[],c;c=this.isReady(b);var p;c===
this.m&&x(new l.exception.notReady("generator isn't seeded"));if(c&this.u){c=!(c&this.t);p=[];var f=0,h;this.O=p[0]=(new Date).valueOf()+this.T;for(h=0;16>h;h++)p.push(4294967296*Math.random()|0);for(h=0;h<this.c.length&&(p=p.concat(this.c[h].finalize()),f+=this.i[h],this.i[h]=0,c||!(this.F&1<<h));h++);this.F>=1<<this.c.length&&(this.c.push(new l.hash.sha256),this.i.push(0));this.d-=f;f>this.j&&(this.j=f);this.F++;this.b=l.hash.sha256.hash(this.b.concat(p));this.A=new l.cipher.aes(this.b);for(c=0;4>
c&&(this.f[c]=this.f[c]+1|0,!this.f[c]);c++);}for(c=0;c<a;c+=4)0===(c+1)%this.S&&Y(this),p=Q(this),d.push(p[0],p[1],p[2],p[3]);Y(this);return d.slice(0,a)},setDefaultParanoia:function(a,b){0===a&&"Setting paranoia\x3d0 will ruin your security; use it only for testing"!==b&&x("Setting paranoia\x3d0 will ruin your security; use it only for testing");this.B=a},addEntropy:function(a,b,d){d=d||"user";var c,p,f=(new Date).valueOf(),h=this.s[d],e=this.isReady(),g=0;c=this.K[d];c===r&&(c=this.K[d]=this.W++);
h===r&&(h=this.s[d]=0);this.s[d]=(this.s[d]+1)%this.c.length;switch(typeof a){case "number":b===r&&(b=1);this.c[h].update([c,this.C++,1,b,f,1,a|0]);break;case "object":d=Object.prototype.toString.call(a);if("[object Uint32Array]"===d){p=[];for(d=0;d<a.length;d++)p.push(a[d]);a=p}else for("[object Array]"!==d&&(g=1),d=0;d<a.length&&!g;d++)"number"!==typeof a[d]&&(g=1);if(!g){if(b===r)for(d=b=0;d<a.length;d++)for(p=a[d];0<p;)b++,p>>>=1;this.c[h].update([c,this.C++,2,b,f,a.length].concat(a))}break;case "string":b===
r&&(b=a.length);this.c[h].update([c,this.C++,3,b,f,a.length]);this.c[h].update(a);break;default:g=1}g&&x(new l.exception.bug("random: addEntropy only supports number, array of numbers or string"));this.i[h]+=b;this.d+=b;e===this.m&&(this.isReady()!==this.m&&ca("seeded",Math.max(this.j,this.d)),ca("progress",this.getProgress()))},isReady:function(a){a=this.I[a!==r?a:this.B];return this.j&&this.j>=a?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=a?this.u|this.m:this.m},getProgress:function(a){a=
this.I[a?a:this.B];return this.j>=a?1:this.d>a?1:this.d/a},startCollectors:function(){this.q||(this.a={loadTimeCollector:aa(this,this.aa),mouseCollector:aa(this,this.ba),keyboardCollector:aa(this,this.$),accelerometerCollector:aa(this,this.U)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,
!1)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):x(new l.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,
!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=!1)},addEventListener:function(a,b){this.w[a][this.V++]=b},removeEventListener:function(a,b){var d,c,p=this.w[a],f=[];for(c in p)p.hasOwnProperty(c)&&p[c]===b&&f.push(c);for(d=0;d<f.length;d++)c=f[d],delete p[c]},$:function(){U(1)},
ba:function(a){var b,d;try{b=a.x||a.clientX||a.offsetX||0,d=a.y||a.clientY||a.offsetY||0}catch(c){d=b=0}0!=b&&0!=d&&l.random.addEntropy([b,d],2,"mouse");U(0)},aa:function(){U(2)},U:function(a){a=(a.accelerationIncludingGravity||{}).x||(a.accelerationIncludingGravity||{}).y||(a.accelerationIncludingGravity||{}).z;if(window.orientation){var b=window.orientation;"number"===typeof b&&l.random.addEntropy(b,1,"accelerometer")}a&&l.random.addEntropy(a,2,"accelerometer");U(0)}};l.random=new l.prng(6);a:try{var m,
V,W,X;if(X="undefined"!==typeof module){var Z;if(Z=module.exports){var $;try{$=require("crypto")}catch(da){$=null}Z=(V=$)&&V.randomBytes}X=Z}if(X)m=V.randomBytes(128),m=new Uint32Array((new Uint8Array(m)).buffer),l.random.addEntropy(m,1024,"crypto['randomBytes']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){W=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(W);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(W);
else break a;l.random.addEntropy(W,1024,"crypto['getRandomValues']")}}catch(fa){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(fa))}l.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(a,b,d,c){d=d||{};c=c||{};var p=l.json,f=p.e({iv:l.random.randomWords(4,0)},p.defaults),h;p.e(f,d);d=f.adata;"string"===typeof f.salt&&(f.salt=l.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=
l.codec.base64.toBits(f.iv));(!l.mode[f.mode]||!l.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)&&x(new l.exception.invalid("json encrypt: invalid parameters"));"string"===typeof a?(h=l.misc.cachedPbkdf2(a,f),a=h.key.slice(0,f.ks/32),f.salt=h.salt):l.ecc&&a instanceof l.ecc.elGamal.publicKey&&(h=a.kem(),f.kemtag=h.tag,a=h.key.slice(0,f.ks/32));"string"===typeof b&&(b=l.codec.utf8String.toBits(b));
"string"===typeof d&&(d=l.codec.utf8String.toBits(d));h=new l.cipher[f.cipher](a);p.e(c,f);c.key=a;f.ct=l.mode[f.mode].encrypt(h,b,f.iv,d,f.ts);return f},encrypt:function(a,b,d,c){var p=l.json,f=p.Y.apply(p,arguments);return p.encode(f)},X:function(a,b,d,c){d=d||{};c=c||{};var p=l.json;b=p.e(p.e(p.e({},p.defaults),b),d,!0);var f,h;f=b.adata;"string"===typeof b.salt&&(b.salt=l.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=l.codec.base64.toBits(b.iv));(!l.mode[b.mode]||!l.cipher[b.cipher]||
"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)&&x(new l.exception.invalid("json decrypt: invalid parameters"));"string"===typeof a?(h=l.misc.cachedPbkdf2(a,b),a=h.key.slice(0,b.ks/32),b.salt=h.salt):l.ecc&&a instanceof l.ecc.elGamal.secretKey&&(a=a.unkem(l.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=l.codec.utf8String.toBits(f));h=new l.cipher[b.cipher](a);f=l.mode[b.mode].decrypt(h,
b.ct,b.iv,f,b.ts);p.e(c,b);c.key=a;return 1===d.raw?f:l.codec.utf8String.fromBits(f)},decrypt:function(a,b,d,c){var p=l.json;return p.X(a,p.decode(b),d,c)},encode:function(a){var b,d="{",c="";for(b in a)if(a.hasOwnProperty(b))switch(b.match(/^[a-z0-9]+$/i)||x(new l.exception.invalid("json encode: invalid property name")),d+=c+'"'+b+'":',c=",",typeof a[b]){case "number":case "boolean":d+=a[b];break;case "string":d+='"'+escape(a[b])+'"';break;case "object":d+='"'+l.codec.base64.fromBits(a[b],0)+'"';
break;default:x(new l.exception.bug("json encode: unsupported type"))}return d+"}"},decode:function(a){a=a.replace(/\s/g,"");a.match(/^\{.*\}$/)||x(new l.exception.invalid("json decode: this isn't json!"));a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},d,c;for(d=0;d<a.length;d++)(c=a[d].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))||x(new l.exception.invalid("json decode: this isn't json!")),b[c[2]]=c[3]?parseInt(c[3],10):c[2].match(/^(ct|salt|iv)$/)?l.codec.base64.toBits(c[4]):
unescape(c[4]);return b},e:function(a,b,d){a===r&&(a={});if(b===r)return a;for(var c in b)b.hasOwnProperty(c)&&(d&&a[c]!==r&&a[c]!==b[c]&&x(new l.exception.invalid("required parameter overridden")),a[c]=b[c]);return a},ea:function(a,b){var d={},c;for(c in a)a.hasOwnProperty(c)&&a[c]!==b[c]&&(d[c]=a[c]);return d},da:function(a,b){var d={},c;for(c=0;c<b.length;c++)a[b[c]]!==r&&(d[b[c]]=a[b[c]]);return d}};l.encrypt=l.json.encrypt;l.decrypt=l.json.decrypt;l.misc.ca={};l.misc.cachedPbkdf2=function(a,
b){var d=l.misc.ca,c;b=b||{};c=b.iter||1E3;d=d[a]=d[a]||{};c=d[c]=d[c]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):l.random.randomWords(2,0)};d=b.salt===r?c.firstSalt:b.salt;c[d]=c[d]||l.misc.pbkdf2(a,d,b.iter);return{key:c[d].slice(0),salt:d.slice(0)}};(function(a){var b=a.codec.bytes=a.codec.bytes||{};b.fromBits=b.fromBits||function(b){var c=[],p=a.bitArray.bitLength(b),f,h;for(f=0;f<p/8;f++)0===(f&3)&&(h=b[f/4]),c.push(h>>>24),h<<=8;return c};b.toBits=b.toBits||function(b){var c=[],p,f=0;
for(p=0;p<b.length;p++)f=f<<8|b[p],3===(p&3)&&(c.push(f),f=0);p&3&&c.push(a.bitArray.partial(8*(p&3),f));return c}})(l);var s;(function(){function a(a,b,c,d){if("function"===typeof a.addEventListener)a.addEventListener(b,c,d);else if(a.attachEvent)a.attachEvent("on"+b,c);else throw Error(L.errors.UNABLETOBIND+": Unable to bind "+b+"-event");}function b(a){var b=function(){return{}};window.jQuery&&"function"==typeof window.jQuery._data&&(b=function(a){return window.jQuery._data(a,"events")});for(var c=
a,d=0,e=[],g="onmousedown onmouseup onmouseover onmouseout onclick onmousemove ondblclick onerror onresize onscroll onkeydown onkeyup onkeypress onchange onsubmit".split(" "),m=g.length,n=0;c&&c!==c.documentElement;){n++;for(var l=m,q,r=(c.nodeName||c.tagName||"").toUpperCase().substring(0,3);l--;)q=g[l],c[name]&&(q=q+(c===a?"Own":"Par")+r,d++,e[q]=e[q]||0,e[q]++);var s=b(c);if("object"===typeof s)for(q in s)s.hasOwnProperty(q)&&(l=s[q].length,q=q+(c===a?"Own":"Par")+r,e[q]=e[q]||0,e[q]+=l,d+=l);
if(!c.parentNode)break;c=c.parentNode}a=["total\x3d"+d];for(var t in e)e.hasOwnProperty(t)&&0<e[t]&&a.push(t+"\x3d"+e[t]);return a.join("\x26")}var c=(new Date).getTime();s=s||function(){var k={};return function(e,f,h){if("bind"===e)s(h+"Bind"),a(f,"change",function(a){s(h+"FieldChangeCount");s("log",h,"ch");try{s("set",h+"FieldEvHa",b(f))}catch(c){s("set",h+"FieldEvHa","Err")}},!0),a(f,"click",function(){s(h+"FieldClickCount");s("log",h,"cl")},!0),a(f,"focus",function(){s(h+"FieldFocusCount");s("log",
h,"fo")},!0),a(f,"blur",function(){s(h+"FieldBlurCount");s("log",h,"bl")},!0),a(f,"touchstart",function(){s(h+"FieldTouchStartCount");s("log",h,"Ts")},!0),a(f,"touchend",function(){s(h+"FieldTouchEndCount");s("log",h,"Te")},!0),a(f,"touchcancel",function(){s(h+"FieldTouchCancelCount");s("log",h,"Tc")},!0),a(f,"keyup",function(a){16==a.keyCode?s("log",h,"Su"):17==a.keyCode?s("log",h,"Cu"):18==a.keyCode&&s("log",h,"Au")}),a(f,"keydown",function(a){s(h+"FieldKeyCount");switch(a&&a.keyCode){case 8:s("log",
h,"Kb");break;case 16:s("log",h,"Sd");break;case 17:s("log",h,"Cd");break;case 18:s("log",h,"Ad");break;case 37:s("log",h,"Kl");break;case 39:s("log",h,"Kr");break;case 46:s("log",h,"Kd");break;case 32:s("log",h,"Ks");break;default:48<=a.keyCode&&57>=a.keyCode||96<=a.keyCode&&105>=a.keyCode?s("log",h,"KN"):65<=a.keyCode&&90>=a.keyCode?s("log",h,"KL"):(s("log",h,"KU"),s("log",h+"UnkKeys",a.keyCode))}},!0);else if("set"===e)k[f]=h;else if("log"===e){e=f+"FieldLog";var g=(new Date).getTime()-c,g=Math.round(g/
100);k.hasOwnProperty(e)?k[e]+=","+h+"@"+g:k[e]=h+"@"+g;1500<k[e].length&&(k[e]=k[e].substring(k[e].length-1500),k[e]=k[e].substring(k[e].indexOf(",")+1))}else if("extend"===e)for(g in k)"number"!==g&&"expiryMonth"!==g&&"expiryYear"!==g&&"generationtime"!==g&&"holderName"!==g&&"cvc"!==g&&k.hasOwnProperty(g)&&(f[g]=""+k[g]);else k.hasOwnProperty(e)?k[e]++:k[e]=1}}();window&&(window.attachEvent||window.addEventListener)&&(a(window,"focus",function(){s("activate");window.location&&"string"==typeof window.location.href&&
s("set","referrer",window.location.href)}),a(window,"blur",function(){s("deactivate")}))})();var E=e.adyen=e.adyen||{},L=E.encrypt=E.encrypt||{createEncryption:function(a,b){return new P(a,b)}};"function"===typeof g&&g.amd?g("adyen/encrypt",[],function(){return L}):"undefined"!==typeof module&&module.exports&&(module.exports=L);L.errors=L.errors||{};L.version="0_1_20_1";var D={};D.luhnCheck=function(){var a={};return function(){var b=arguments,b=0<arguments.length?b[0]:this.cardnumber;if(isNaN(parseInt(b,
10)))return!1;var c=b.length,k=c&1,e=0;if("undefined"===typeof a[b]){14<=c&&s("luhnCount");for(var f=0;f<c;f++){var h=parseInt(b.charAt(f),10);f&1^k||(h*=2,9<h&&(h-=9));e+=h}0===e%10?(s("luhnOkCount"),a[b]=!0):(s("luhnFailCount"),a[b]=!1)}var k=0,g;for(g in a)a.hasOwnProperty(g)&&g.length===c&&k++;s("set","luhnSameLengthCount",k);return a[b]}}();D.numberCheck=function(a){return(a||"").replace(/[^\d]/g,"").match(/^\d{10,20}$/)&&D.luhnCheck(a)?!0:!1};D.cvcCheck=function(a){return a&&a.match&&a.match(/^\d{3,4}$/)?
!0:!1};D.yearCheck=function(a){if(!a||!a.match||!a.match(/^2\d{3}$/))return!1;a=parseInt(a,10);var b=(new Date).getFullYear();return a>=b-2&&a<=b+15};D.monthCheck=function(a){a=(a||"").replace(/^0(\d)$/,"$1");return a.match(/^([1-9]|10|11|12)$/)&&1<=parseInt(a,10)&&12>=parseInt(a,10)?!0:!1};D.holderNameCheck=function(a){return a&&a.match&&a.match(/\S/)?!0:!1};D.generationTimeValidDate=function(a){return"string"!==typeof a?!1:(a=a.match(/^(\d{4})-?(\d{2})-?(\d{2})$/))&&(""+a[1]).match(/^20[1-9][0-9]$/)&&
(""+a[2]).match(/^(12|11|10|0[1-9])$/)&&(""+a[3]).match(/^(31|30|20|10|[012][1-9])$/)?!0:!1};D.generationTimeValidTime=function(a){if("string"!==typeof a)return!1;var b=/(Z|[\+\-][012345][0-9]:?[012345][0-9])$/;return a.match(b)?a.replace(b,"").replace(/\.\d{3}$/,"").match(/^[012345][0-9]:?[012345][0-9]:?[012345][0-9]$/):!1};D.generationTimeCheck=function(a){if("string"!==typeof a)return!1;a=a.split("T");return 2===a.length&&D.generationTimeValidDate(a[0])&&D.generationTimeValidTime(a[1])?!0:!1};
var P=function(a,b){try{l.random.startCollectors()}catch(c){}this.key=a;this.options=b||{};"undefined"===typeof this.options.numberIgnoreNonNumeric&&(this.options.numberIgnoreNonNumeric=!0);"undefined"!==typeof this.options.cvcIgnoreFornumber&&delete this.options.cvcIgnoreFornumber;"undefined"===typeof this.options.fourDigitCvcForBins&&(this.options.fourDigitCvcForBins="34,37");"undefined"!==typeof this.options.cvcLengthFornumber&&delete this.options.cvcLengthFornumber;if("string"===typeof this.options.cvcIgnoreBins){var k=
[];this.options.cvcIgnoreBins.replace(/\d+/g,function(a){0<a.length&&!isNaN(parseInt(a,10))&&k.push(a);return a});0<k.length&&(this.options.cvcIgnoreFornumber=new RegExp("^\\s*("+k.join("|")+")"))}else"undefined"!==typeof this.options.cvcIgnoreBins&&delete this.options.cvcIgnoreBins;if("string"===typeof this.options.fourDigitCvcForBins){var e=[];this.options.fourDigitCvcForBins.replace(/\d+/g,function(a){0<a.length&&!isNaN(parseInt(a,10))&&e.push(a);return a});0<e.length&&(this.options.cvcLengthFornumber=
{matcher:new RegExp("^\\s*("+e.join("|")+")"),requiredLength:4})}delete this.options.fourDigitCvcForBins;s("initializeCount")};P.prototype.createRSAKey=function(){var a=this.key.split("|");if(2!==a.length)throw"Malformed public key";var b=a[0],a=a[1],c=new N;c.setPublic(a,b);return c};P.prototype.createAESKey=function(){return new c};P.prototype.encrypt=function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);a={};"undefined"!==typeof b.number&&(a.number=b.number);"undefined"!==typeof b.cvc&&
(a.cvc=b.cvc);"undefined"!==typeof b.expiryMonth&&(a.month=b.expiryMonth);"undefined"!==typeof b.expiryYear&&(a.year=b.expiryYear);"undefined"!==typeof b.holderName&&(a.holderName=b.holderName);"undefined"!==typeof b.generationtime&&(a.generationtime=b.generationtime);if(!1!==this.options.enableValidations&&!1===this.validate(a).valid)return!1;for(a=0;11>a;a++)if(l.random&&l.random.isReady(a))s("set","sjclStrength",a);else break;s("extend",b);try{b.dfValue=""}catch(k){}a=this.createRSAKey();c=this.createAESKey();
b=c.encrypt(JSON.stringify(b));c=l.codec.bytes.fromBits(c.key());a=a.encrypt_b64(c);return["adyenjs_"+L.version+"$",a,"$",b].join("")};P.prototype.validate=function(a){var b={valid:!0};if("object"!==typeof a)return b.valid=!1,b;for(var c in a)if(a.hasOwnProperty(c)&&"undefined"!==typeof a[c]){var k=a[c];this.options[c+"IgnoreNonNumeric"]&&(k=k.replace(/\D/g,""));if(!this.options[c+"SkipValidation"]){for(var e in a)if(a.hasOwnProperty(e)){var f=this.options[c+"IgnoreFor"+e],h=this.options[c+"LengthFor"+
e];f&&a[e].match(f)?b[c]=!0:h&&h.matcher&&h.requiredLength&&a[e].match(h.matcher)&&k.length!==h.requiredLength&&(b[c]=!1)}if(b.hasOwnProperty(c))b.valid=b.valid&&b[c];else switch(c){case "number":b.number=D.numberCheck(k);b.luhn=b.number;b.valid=b.valid&&b.number;break;case "expiryYear":case "year":b.year=D.yearCheck(k);b.expiryYear=b.year;b.valid=b.valid&&b.year;break;case "cvc":b.cvc=D.cvcCheck(k);b.valid=b.valid&&b.cvc;break;case "expiryMonth":case "month":b.month=D.monthCheck(k);b.expiryMonth=
b.month;b.valid=b.valid&&b.month;break;case "holderName":b.holderName=D.holderNameCheck(k);b.valid=b.valid&&b.holderName;break;case "generationtime":b.generationtime=D.generationTimeCheck(k);b.valid=b.valid&&b.generationtime;break;default:b.unknown=b.unknown||[],b.unknown.push(c),b.valid=!1}}}return b};P.prototype.monitor=function(a,b){if("string"!==typeof a||"number"!==a&&"cvc"!==a&&"holderName"!==a)throw Error("invalid fieldname. Expected 'number', 'cvc' or 'holderName', but received '"+a+"'");
s("bind",b,a)};var c=function(){};c.prototype={constructor:c,key:function(){return this._key=this._key||l.random.randomWords(8,6)},encrypt:function(a){return this.encryptWithIv(a,l.random.randomWords(3,6))},encryptWithIv:function(a,b){var c,k;c=new l.cipher.aes(this.key());k=l.codec.utf8String.toBits(a);c=l.mode.ccm.encrypt(c,k,b);c=l.bitArray.concat(b,c);return l.codec.base64.fromBits(c)}}})(this,"function"===typeof define?define:null);
(function(){function e(){this.n=null;this.e=0;this.coeff=this.dmq1=this.dmp1=this.q=this.p=this.d=null}function g(c,a,b){null!=c&&("number"==typeof c?this.fromNumber(c,a,b):null==a&&"string"!=typeof c?this.fromString(c,256):this.fromString(c,a))}function n(){return new g(null)}function q(c,a,b,d,k,e){for(;0<=--e;){var f=a*this[c++]+b[d]+k;k=Math.floor(f/67108864);b[d++]=f&67108863}return k}function t(c,a,b,d,k,e){var f=a&32767;for(a>>=15;0<=--e;){var h=this[c]&32767,g=this[c++]>>15,m=a*h+g*f,h=f*
h+((m&32767)<<15)+b[d]+(k&1073741823);k=(h>>>30)+(m>>>15)+a*g+(k>>>30);b[d++]=h&1073741823}return k}function F(c,a,b,d,k,e){var f=a&16383;for(a>>=14;0<=--e;){var h=this[c]&16383,g=this[c++]>>14,m=a*h+g*f,h=f*h+((m&16383)<<14)+b[d]+k;k=(h>>28)+(m>>14)+a*g;b[d++]=h&268435455}return k}function K(c){var a=n();a.fromInt(c);return a}function H(c){var a=1,b;0!=(b=c>>>16)&&(c=b,a+=16);0!=(b=c>>8)&&(c=b,a+=8);0!=(b=c>>4)&&(c=b,a+=4);0!=(b=c>>2)&&(c=b,a+=2);0!=c>>1&&(a+=1);return a}function I(c){this.m=c}function G(c){this.m=
c;this.mp=c.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<c.DB-15)-1;this.mt2=2*c.t}function J(c){A[u++]^=c&255;A[u++]^=c>>8&255;A[u++]^=c>>16&255;A[u++]^=c>>24&255;u>=l&&(u-=l)}function M(){}function T(){this.j=this.i=0;this.S=[]}function z(c){throw c;}function N(c,a,b){4!==a.length&&z(new m.exception.invalid("invalid aes block size"));var d=c.b[b],k=a[0]^d[0],e=a[b?3:1]^d[1],f=a[2]^d[2];a=a[b?1:3]^d[3];var h,g,n,l=d.length/4-2,q,w=4,r=[0,0,0,0];h=c.k[b];c=h[0];var s=h[1],t=
h[2],u=h[3],x=h[4];for(q=0;q<l;q++)h=c[k>>>24]^s[e>>16&255]^t[f>>8&255]^u[a&255]^d[w],g=c[e>>>24]^s[f>>16&255]^t[a>>8&255]^u[k&255]^d[w+1],n=c[f>>>24]^s[a>>16&255]^t[k>>8&255]^u[e&255]^d[w+2],a=c[a>>>24]^s[k>>16&255]^t[e>>8&255]^u[f&255]^d[w+3],w+=4,k=h,e=g,f=n;for(q=0;4>q;q++)r[b?3&-q:q]=x[k>>>24]<<24^x[e>>16&255]<<16^x[f>>8&255]<<8^x[a&255]^d[w++],h=k,k=e,e=f,f=a,a=h;return r}function x(c,a){var b,d,k,e=a.slice(0),f=c.r,h=c.b,g=f[0],m=f[1],n=f[2],l=f[3],q=f[4],r=f[5],s=f[6],t=f[7];for(b=0;64>b;b++)16>
b?d=e[b]:(d=e[b+1&15],k=e[b+14&15],d=e[b&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(k>>>17^k>>>19^k>>>10^k<<15^k<<13)+e[b&15]+e[b+9&15]|0),d=d+t+(q>>>6^q>>>11^q>>>25^q<<26^q<<21^q<<7)+(s^q&(r^s))+h[b],t=s,s=r,r=q,q=l+d|0,l=n,n=m,m=g,g=d+(m&n^l&(m^n))+(m>>>2^m>>>13^m>>>22^m<<30^m<<19^m<<10)|0;f[0]=f[0]+g|0;f[1]=f[1]+m|0;f[2]=f[2]+n|0;f[3]=f[3]+l|0;f[4]=f[4]+q|0;f[5]=f[5]+r|0;f[6]=f[6]+s|0;f[7]=f[7]+t|0}function ba(c,a){var b,d=m.random.w[c],k=[];for(b in d)d.hasOwnProperty(b)&&k.push(d[b]);for(b=0;b<k.length;b++)k[b](a)}
function O(c){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?m.random.addEntropy(window.performance.now(),c,"loadtime"):m.random.addEntropy((new Date).valueOf(),c,"loadtime")}function ca(c){c.b=U(c).concat(U(c));c.A=new m.cipher.aes(c.b)}function U(c){for(var a=0;4>a&&(c.f[a]=c.f[a]+1|0,!c.f[a]);a++);return c.A.encrypt(c.f)}function Y(c,a){return function(){a.apply(c,arguments)}}e.prototype.doPublic=function(c){return c.modPowInt(this.e,this.n)};e.prototype.setPublic=
function(c,a){null!=c&&null!=a&&0<c.length&&0<a.length?(this.n=new g(c,16),this.e=parseInt(a,16)):alert("Invalid RSA public key")};e.prototype.encrypt=function(c){var a;a=this.n.bitLength()+7>>3;if(a<c.length+11)alert("Message too long for RSA"),a=null;else{for(var b=[],d=c.length-1;0<=d&&0<a;){var k=c.charCodeAt(d--);128>k?b[--a]=k:127<k&&2048>k?(b[--a]=k&63|128,b[--a]=k>>6|192):(b[--a]=k&63|128,b[--a]=k>>6&63|128,b[--a]=k>>12|224)}b[--a]=0;c=new M;for(d=[];2<a;){for(d[0]=0;0==d[0];)c.nextBytes(d);
b[--a]=d[0]}b[--a]=2;b[--a]=0;a=new g(b)}if(null==a)return null;a=this.doPublic(a);if(null==a)return null;a=a.toString(16);return 0==(a.length&1)?a:"0"+a};e.prototype.encrypt_b64=function(c){if(c=this.encrypt(c)){var a,b,d="";for(a=0;a+3<=c.length;a+=3)b=parseInt(c.substring(a,a+3),16),d+=Q.charAt(b>>6)+Q.charAt(b&63);a+1==c.length?(b=parseInt(c.substring(a,a+1),16),d+=Q.charAt(b<<2)):a+2==c.length&&(b=parseInt(c.substring(a,a+2),16),d+=Q.charAt(b>>2)+Q.charAt((b&3)<<4));for(;0<(d.length&3);)d+=aa;
return d}return null};var Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",aa="\x3d",B;"Microsoft Internet Explorer"==navigator.appName?(g.prototype.am=t,B=30):"Netscape"!=navigator.appName?(g.prototype.am=q,B=26):(g.prototype.am=F,B=28);g.prototype.DB=B;g.prototype.DM=(1<<B)-1;g.prototype.DV=1<<B;g.prototype.FV=Math.pow(2,52);g.prototype.F1=52-B;g.prototype.F2=2*B-52;var R=[],C;B=48;for(C=0;9>=C;++C)R[B++]=C;B=97;for(C=10;36>C;++C)R[B++]=C;B=65;for(C=10;36>C;++C)R[B++]=C;I.prototype.convert=
function(c){return 0>c.s||0<=c.compareTo(this.m)?c.mod(this.m):c};I.prototype.revert=function(c){return c};I.prototype.reduce=function(c){c.divRemTo(this.m,null,c)};I.prototype.mulTo=function(c,a,b){c.multiplyTo(a,b);this.reduce(b)};I.prototype.sqrTo=function(c,a){c.squareTo(a);this.reduce(a)};G.prototype.convert=function(c){var a=n();c.abs().dlShiftTo(this.m.t,a);a.divRemTo(this.m,null,a);0>c.s&&0<a.compareTo(g.ZERO)&&this.m.subTo(a,a);return a};G.prototype.revert=function(c){var a=n();c.copyTo(a);
this.reduce(a);return a};G.prototype.reduce=function(c){for(;c.t<=this.mt2;)c[c.t++]=0;for(var a=0;a<this.m.t;++a){var b=c[a]&32767,d=b*this.mpl+((b*this.mph+(c[a]>>15)*this.mpl&this.um)<<15)&c.DM,b=a+this.m.t;for(c[b]+=this.m.am(0,d,c,a,0,this.m.t);c[b]>=c.DV;)c[b]-=c.DV,c[++b]++}c.clamp();c.drShiftTo(this.m.t,c);0<=c.compareTo(this.m)&&c.subTo(this.m,c)};G.prototype.mulTo=function(c,a,b){c.multiplyTo(a,b);this.reduce(b)};G.prototype.sqrTo=function(c,a){c.squareTo(a);this.reduce(a)};g.prototype.copyTo=
function(c){for(var a=this.t-1;0<=a;--a)c[a]=this[a];c.t=this.t;c.s=this.s};g.prototype.fromInt=function(c){this.t=1;this.s=0>c?-1:0;0<c?this[0]=c:-1>c?this[0]=c+this.DV:this.t=0};g.prototype.fromString=function(c,a){var b;if(16==a)b=4;else if(8==a)b=3;else if(256==a)b=8;else if(2==a)b=1;else if(32==a)b=5;else if(4==a)b=2;else{this.fromRadix(c,a);return}this.s=this.t=0;for(var d=c.length,k=!1,e=0;0<=--d;){var f;8==b?f=c[d]&255:(f=R[c.charCodeAt(d)],f=null==f?-1:f);0>f?"-"==c.charAt(d)&&(k=!0):(k=
!1,0==e?this[this.t++]=f:e+b>this.DB?(this[this.t-1]|=(f&(1<<this.DB-e)-1)<<e,this[this.t++]=f>>this.DB-e):this[this.t-1]|=f<<e,e+=b,e>=this.DB&&(e-=this.DB))}8==b&&0!=(c[0]&128)&&(this.s=-1,0<e&&(this[this.t-1]|=(1<<this.DB-e)-1<<e));this.clamp();k&&g.ZERO.subTo(this,this)};g.prototype.clamp=function(){for(var c=this.s&this.DM;0<this.t&&this[this.t-1]==c;)--this.t};g.prototype.dlShiftTo=function(c,a){var b;for(b=this.t-1;0<=b;--b)a[b+c]=this[b];for(b=c-1;0<=b;--b)a[b]=0;a.t=this.t+c;a.s=this.s};
g.prototype.drShiftTo=function(c,a){for(var b=c;b<this.t;++b)a[b-c]=this[b];a.t=Math.max(this.t-c,0);a.s=this.s};g.prototype.lShiftTo=function(c,a){var b=c%this.DB,d=this.DB-b,k=(1<<d)-1,e=Math.floor(c/this.DB),f=this.s<<b&this.DM,h;for(h=this.t-1;0<=h;--h)a[h+e+1]=this[h]>>d|f,f=(this[h]&k)<<b;for(h=e-1;0<=h;--h)a[h]=0;a[e]=f;a.t=this.t+e+1;a.s=this.s;a.clamp()};g.prototype.rShiftTo=function(c,a){a.s=this.s;var b=Math.floor(c/this.DB);if(b>=this.t)a.t=0;else{var d=c%this.DB,e=this.DB-d,p=(1<<d)-
1;a[0]=this[b]>>d;for(var f=b+1;f<this.t;++f)a[f-b-1]|=(this[f]&p)<<e,a[f-b]=this[f]>>d;0<d&&(a[this.t-b-1]|=(this.s&p)<<e);a.t=this.t-b;a.clamp()}};g.prototype.subTo=function(c,a){for(var b=0,d=0,e=Math.min(c.t,this.t);b<e;)d+=this[b]-c[b],a[b++]=d&this.DM,d>>=this.DB;if(c.t<this.t){for(d-=c.s;b<this.t;)d+=this[b],a[b++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;b<c.t;)d-=c[b],a[b++]=d&this.DM,d>>=this.DB;d-=c.s}a.s=0>d?-1:0;-1>d?a[b++]=this.DV+d:0<d&&(a[b++]=d);a.t=b;a.clamp()};g.prototype.multiplyTo=
function(c,a){var b=this.abs(),d=c.abs(),e=b.t;for(a.t=e+d.t;0<=--e;)a[e]=0;for(e=0;e<d.t;++e)a[e+b.t]=b.am(0,d[e],a,e,0,b.t);a.s=0;a.clamp();this.s!=c.s&&g.ZERO.subTo(a,a)};g.prototype.squareTo=function(c){for(var a=this.abs(),b=c.t=2*a.t;0<=--b;)c[b]=0;for(b=0;b<a.t-1;++b){var d=a.am(b,a[b],c,2*b,0,1);(c[b+a.t]+=a.am(b+1,2*a[b],c,2*b+1,d,a.t-b-1))>=a.DV&&(c[b+a.t]-=a.DV,c[b+a.t+1]=1)}0<c.t&&(c[c.t-1]+=a.am(b,a[b],c,2*b,0,1));c.s=0;c.clamp()};g.prototype.divRemTo=function(c,a,b){var d=c.abs();if(!(0>=
d.t)){var e=this.abs();if(e.t<d.t)null!=a&&a.fromInt(0),null!=b&&this.copyTo(b);else{null==b&&(b=n());var p=n(),f=this.s;c=c.s;var h=this.DB-H(d[d.t-1]);0<h?(d.lShiftTo(h,p),e.lShiftTo(h,b)):(d.copyTo(p),e.copyTo(b));d=p.t;e=p[d-1];if(0!=e){var m=e*(1<<this.F1)+(1<d?p[d-2]>>this.F2:0),l=this.FV/m,m=(1<<this.F1)/m,q=1<<this.F2,r=b.t,w=r-d,s=null==a?n():a;p.dlShiftTo(w,s);0<=b.compareTo(s)&&(b[b.t++]=1,b.subTo(s,b));g.ONE.dlShiftTo(d,s);for(s.subTo(p,p);p.t<d;)p[p.t++]=0;for(;0<=--w;){var t=b[--r]==
e?this.DM:Math.floor(b[r]*l+(b[r-1]+q)*m);if((b[r]+=p.am(0,t,b,w,0,d))<t)for(p.dlShiftTo(w,s),b.subTo(s,b);b[r]<--t;)b.subTo(s,b)}null!=a&&(b.drShiftTo(d,a),f!=c&&g.ZERO.subTo(a,a));b.t=d;b.clamp();0<h&&b.rShiftTo(h,b);0>f&&g.ZERO.subTo(b,b)}}}};g.prototype.invDigit=function(){if(1>this.t)return 0;var c=this[0];if(0==(c&1))return 0;var a=c&3,a=a*(2-(c&15)*a)&15,a=a*(2-(c&255)*a)&255,a=a*(2-((c&65535)*a&65535))&65535,a=a*(2-c*a%this.DV)%this.DV;return 0<a?this.DV-a:-a};g.prototype.isEven=function(){return 0==
(0<this.t?this[0]&1:this.s)};g.prototype.exp=function(c,a){if(4294967295<c||1>c)return g.ONE;var b=n(),d=n(),e=a.convert(this),p=H(c)-1;for(e.copyTo(b);0<=--p;)if(a.sqrTo(b,d),0<(c&1<<p))a.mulTo(d,e,b);else var f=b,b=d,d=f;return a.revert(b)};g.prototype.toString=function(c){if(0>this.s)return"-"+this.negate().toString(c);if(16==c)c=4;else if(8==c)c=3;else if(2==c)c=1;else if(32==c)c=5;else if(4==c)c=2;else return this.toRadix(c);var a=(1<<c)-1,b,d=!1,e="",p=this.t,f=this.DB-p*this.DB%c;if(0<p--)for(f<
this.DB&&0<(b=this[p]>>f)&&(d=!0,e="0123456789abcdefghijklmnopqrstuvwxyz".charAt(b));0<=p;)f<c?(b=(this[p]&(1<<f)-1)<<c-f,b|=this[--p]>>(f+=this.DB-c)):(b=this[p]>>(f-=c)&a,0>=f&&(f+=this.DB,--p)),0<b&&(d=!0),d&&(e+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(b));return d?e:"0"};g.prototype.negate=function(){var c=n();g.ZERO.subTo(this,c);return c};g.prototype.abs=function(){return 0>this.s?this.negate():this};g.prototype.compareTo=function(c){var a=this.s-c.s;if(0!=a)return a;var b=this.t,a=b-
c.t;if(0!=a)return 0>this.s?-a:a;for(;0<=--b;)if(0!=(a=this[b]-c[b]))return a;return 0};g.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+H(this[this.t-1]^this.s&this.DM)};g.prototype.mod=function(c){var a=n();this.abs().divRemTo(c,null,a);0>this.s&&0<a.compareTo(g.ZERO)&&c.subTo(a,a);return a};g.prototype.modPowInt=function(c,a){var b;b=256>c||a.isEven()?new I(a):new G(a);return this.exp(c,b)};g.ZERO=K(0);g.ONE=K(1);var S,A,u;if(null==A){A=[];u=0;var r;try{if(window.crypto&&
window.crypto.getRandomValues){var E=new Uint8Array(32);window.crypto.getRandomValues(E);for(r=0;32>r;++r)A[u++]=E[r]}else if(window.msCrypto&&window.msCrypto.getRandomValues)for(E=new Uint8Array(32),window.msCrypto.getRandomValues(E),r=0;32>r;++r)A[u++]=E[r];else if(window.crypto&&window.crypto.random)for(x=window.crypto.random(32),r=0;r<x.length;++r)A[u++]=x.charCodeAt(r)&255}catch(ga){}for(;u<l;)r=Math.floor(65536*Math.random()),A[u++]=r>>>8,A[u++]=r&255;u=0;J((new Date).getTime())}M.prototype.nextBytes=
function(c){var a;for(a=0;a<c.length;++a){var b=a,d;if(null==S){J((new Date).getTime());S=new T;S.init(A);for(u=0;u<A.length;++u)A[u]=0;u=0}d=S.next();c[b]=d}};(function(){function c(a,b){return this.slice(a,b)}function a(a,b){2>arguments.length&&(b=0);for(var c=0,d=a.length;c<d;++c,++b)this[b]=a[c]&255}function b(b){var d;if("number"===typeof b){d=Array(b);for(var e=0;e<b;++e)d[e]=0}else d=b.slice(0);d.subarray=c;d.buffer=d;d.byteLength=d.length;d.set=a;"object"===typeof b&&b.buffer&&(d.buffer=b.buffer);
return d}try{new Uint8Array(1);new Uint32Array(1);new Int32Array(1);return}catch(d){}try{window.Uint8Array=b}catch(e){}try{window.Uint32Array=b}catch(p){}try{window.Int32Array=b}catch(f){}})();(function(){if(!("response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype))try{Object.defineProperty(XMLHttpRequest.prototype,"response",{get:function(){return new Uint8Array((new VBArray(this.responseBody)).toArray())}})}catch(c){}})();
(function(){"btoa"in window||(window.btoa=function(c){var a="",b,d;b=0;for(d=c.length;b<d;b+=3)var e=c.charCodeAt(b)&255,p=c.charCodeAt(b+1)&255,f=c.charCodeAt(b+2)&255,h=(e&3)<<4|p>>4,p=b+1<d?(p&15)<<2|f>>6:64,f=b+2<d?f&63:64,a=a+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(p)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f));
return a})})();"object"!==typeof JSON&&(JSON={});(function(){function c(a){return 10>a?"0"+a:a}function a(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(c,d){var e,k,h,m,n=p,l,q=d[c];q&&"object"===typeof q&&"function"===typeof q.toJSON&&(q=q.toJSON(c));"function"===typeof g&&(q=g.call(d,c,q));switch(typeof q){case "string":return a(q);case "number":return isFinite(q)?
String(q):"null";case "boolean":case "null":return String(q);case "object":if(!q)return"null";p+=f;l=[];if("[object Array]"===Object.prototype.toString.apply(q)){m=q.length;for(e=0;e<m;e+=1)l[e]=b(e,q)||"null";h=0===l.length?"[]":p?"[\n"+p+l.join(",\n"+p)+"\n"+n+"]":"["+l.join(",")+"]";p=n;return h}if(g&&"object"===typeof g)for(m=g.length,e=0;e<m;e+=1)"string"===typeof g[e]&&(k=g[e],(h=b(k,q))&&l.push(a(k)+(p?": ":":")+h));else for(k in q)Object.prototype.hasOwnProperty.call(q,k)&&(h=b(k,q))&&l.push(a(k)+
(p?": ":":")+h);h=0===l.length?"{}":p?"{\n"+p+l.join(",\n"+p)+"\n"+n+"}":"{"+l.join(",")+"}";p=n;return h}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p,f,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,d){var e;f=p="";if("number"===typeof d)for(e=0;e<d;e+=1)f+=" ";else"string"===typeof d&&(f=d);if((g=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var e,f,k=a[d];if(k&&"object"===typeof k)for(e in k)Object.prototype.hasOwnProperty.call(k,e)&&(f=c(k,e),void 0!==f?k[e]=f:delete k[e]);return b.call(a,d,k)}var e;a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof b?c({"":e},""):e;throw new SyntaxError("JSON.parse");})})();T.prototype.init=function(c){var a,b,d;for(a=0;256>a;++a)this.S[a]=a;for(a=b=0;256>a;++a)b=b+this.S[a]+c[a%c.length]&255,d=this.S[a],this.S[a]=this.S[b],this.S[b]=d;this.j=this.i=0};T.prototype.next=function(){var c;this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;c=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=c;return this.S[c+this.S[this.i]&
255]};var l=256;"use strict";r=void 0;var m={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(c){this.toString=function(){return"CORRUPT: "+this.message};this.message=c},invalid:function(c){this.toString=function(){return"INVALID: "+this.message};this.message=c},bug:function(c){this.toString=function(){return"BUG: "+this.message};this.message=c},notReady:function(c){this.toString=function(){return"NOT READY: "+this.message};this.message=c}}};"undefined"!==typeof module&&
module.exports&&(module.exports=m);"function"===typeof define&&define([],function(){return m});m.cipher.aes=function(c){this.k[0][0][0]||this.D();var a,b,d,e,p=this.k[0][4],f=this.k[1];a=c.length;var h=1;4!==a&&6!==a&&8!==a&&z(new m.exception.invalid("invalid aes key size"));this.b=[d=c.slice(0),e=[]];for(c=a;c<4*a+28;c++){b=d[c-1];if(0===c%a||8===a&&4===c%a)b=p[b>>>24]<<24^p[b>>16&255]<<16^p[b>>8&255]<<8^p[b&255],0===c%a&&(b=b<<8^b>>>24^h<<24,h=h<<1^283*(h>>7));d[c]=d[c-a]^b}for(a=0;c;a++,c--)b=
d[a&3?c:c-4],e[a]=4>=c||4>a?b:f[0][p[b>>>24]]^f[1][p[b>>16&255]]^f[2][p[b>>8&255]]^f[3][p[b&255]]};m.cipher.aes.prototype={encrypt:function(c){return N(this,c,0)},decrypt:function(c){return N(this,c,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var c=this.k[0],a=this.k[1],b=c[4],d=a[4],e,p,f,h=[],g=[],m,l,n,q;for(e=0;256>e;e++)g[(h[e]=e<<1^283*(e>>7))^e]=e;for(p=f=0;!b[p];p^=m||1,f=g[f]||1)for(n=f^f<<1^f<<2^f<<3^f<<4,n=n>>8^n&255^99,b[p]=n,d[n]=p,l=h[e=h[m=h[p]]],q=16843009*l^65537*e^257*
m^16843008*p,l=257*h[n]^16843008*n,e=0;4>e;e++)c[e][p]=l=l<<24^l>>>8,a[e][n]=q=q<<24^q>>>8;for(e=0;5>e;e++)c[e]=c[e].slice(0),a[e]=a[e].slice(0)}};m.bitArray={bitSlice:function(c,a,b){c=m.bitArray.P(c.slice(a/32),32-(a&31)).slice(1);return b===r?c:m.bitArray.clamp(c,b-a)},extract:function(c,a,b){var d=Math.floor(-a-b&31);return((a+b-1^a)&-32?c[a/32|0]<<32-d^c[a/32+1|0]>>>d:c[a/32|0]>>>d)&(1<<b)-1},concat:function(c,a){if(0===c.length||0===a.length)return c.concat(a);var b=c[c.length-1],d=m.bitArray.getPartial(b);
return 32===d?c.concat(a):m.bitArray.P(a,d,b|0,c.slice(0,c.length-1))},bitLength:function(c){var a=c.length;return 0===a?0:32*(a-1)+m.bitArray.getPartial(c[a-1])},clamp:function(c,a){if(32*c.length<a)return c;c=c.slice(0,Math.ceil(a/32));var b=c.length;a&=31;0<b&&a&&(c[b-1]=m.bitArray.partial(a,c[b-1]&2147483648>>a-1,1));return c},partial:function(c,a,b){return 32===c?a:(b?a|0:a<<32-c)+1099511627776*c},getPartial:function(c){return Math.round(c/1099511627776)||32},equal:function(c,a){if(m.bitArray.bitLength(c)!==
m.bitArray.bitLength(a))return!1;var b=0,d;for(d=0;d<c.length;d++)b|=c[d]^a[d];return 0===b},P:function(c,a,b,d){var e;for(d===r&&(d=[]);32<=a;a-=32)d.push(b),b=0;if(0===a)return d.concat(c);for(e=0;e<c.length;e++)d.push(b|c[e]>>>a),b=c[e]<<32-a;e=c.length?c[c.length-1]:0;c=m.bitArray.getPartial(e);d.push(m.bitArray.partial(a+c&31,32<a+c?b:d.pop(),1));return d},l:function(c,a){return[c[0]^a[0],c[1]^a[1],c[2]^a[2],c[3]^a[3]]},byteswapM:function(c){var a,b;for(a=0;a<c.length;++a)b=c[a],c[a]=b>>>24|
b>>>8&65280|(b&65280)<<8|b<<24;return c}};m.codec.utf8String={fromBits:function(c){var a="",b=m.bitArray.bitLength(c),d,e;for(d=0;d<b/8;d++)0===(d&3)&&(e=c[d/4]),a+=String.fromCharCode(e>>>24),e<<=8;return decodeURIComponent(escape(a))},toBits:function(c){c=unescape(encodeURIComponent(c));var a=[],b,d=0;for(b=0;b<c.length;b++)d=d<<8|c.charCodeAt(b),3===(b&3)&&(a.push(d),d=0);b&3&&a.push(m.bitArray.partial(8*(b&3),d));return a}};m.codec.hex={fromBits:function(c){var a="",b;for(b=0;b<c.length;b++)a+=
((c[b]|0)+0xf00000000000).toString(16).substr(4);return a.substr(0,m.bitArray.bitLength(c)/4)},toBits:function(c){var a,b=[],d;c=c.replace(/\s|0x/g,"");d=c.length;c+="00000000";for(a=0;a<c.length;a+=8)b.push(parseInt(c.substr(a,8),16)^0);return m.bitArray.clamp(b,4*d)}};m.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(c,a,b){var d="",e=0,p=m.codec.base64.J,f=0,h=m.bitArray.bitLength(c);b&&(p=p.substr(0,62)+"-_");for(b=0;6*d.length<h;)d+=p.charAt((f^
c[b]>>>e)>>>26),6>e?(f=c[b]<<6-e,e+=26,b++):(f<<=6,e-=6);for(;d.length&3&&!a;)d+="\x3d";return d},toBits:function(c,a){c=c.replace(/\s|=/g,"");var b=[],d,e=0,p=m.codec.base64.J,f=0,h;a&&(p=p.substr(0,62)+"-_");for(d=0;d<c.length;d++)h=p.indexOf(c.charAt(d)),0>h&&z(new m.exception.invalid("this isn't base64!")),26<e?(e-=26,b.push(f^h>>>e),f=h<<32-e):(e+=6,f^=h<<32-e);e&56&&b.push(m.bitArray.partial(e&56,f,1));return b}};m.codec.base64url={fromBits:function(c){return m.codec.base64.fromBits(c,1,1)},
toBits:function(c){return m.codec.base64.toBits(c,1)}};m.hash.sha256=function(c){this.b[0]||this.D();c?(this.r=c.r.slice(0),this.o=c.o.slice(0),this.h=c.h):this.reset()};m.hash.sha256.hash=function(c){return(new m.hash.sha256).update(c).finalize()};m.hash.sha256.prototype={blockSize:512,reset:function(){this.r=this.N.slice(0);this.o=[];this.h=0;return this},update:function(c){"string"===typeof c&&(c=m.codec.utf8String.toBits(c));var a,b=this.o=m.bitArray.concat(this.o,c);a=this.h;c=this.h=a+m.bitArray.bitLength(c);
for(a=512+a&-512;a<=c;a+=512)x(this,b.splice(0,16));return this},finalize:function(){var c,a=this.o,b=this.r,a=m.bitArray.concat(a,[m.bitArray.partial(1,1)]);for(c=a.length+2;c&15;c++)a.push(0);a.push(Math.floor(this.h/4294967296));for(a.push(this.h|0);a.length;)x(this,a.splice(0,16));this.reset();return b},N:[],b:[],D:function(){function c(a){return 4294967296*(a-Math.floor(a))|0}var a=0,b=2,d;a:for(;64>a;b++){for(d=2;d*d<=b;d++)if(0===b%d)continue a;8>a&&(this.N[a]=c(Math.pow(b,.5)));this.b[a]=
c(Math.pow(b,1/3));a++}}};m.mode.ccm={name:"ccm",encrypt:function(c,a,b,d,e){var p,f=a.slice(0),h=m.bitArray,g=h.bitLength(b)/8,l=h.bitLength(f)/8;e=e||64;d=d||[];7>g&&z(new m.exception.invalid("ccm: iv must be at least 7 bytes"));for(p=2;4>p&&l>>>8*p;p++);p<15-g&&(p=15-g);b=h.clamp(b,8*(15-p));a=m.mode.ccm.L(c,a,b,d,e,p);f=m.mode.ccm.p(c,f,b,a,e,p);return h.concat(f.data,f.tag)},decrypt:function(c,a,b,d,e){e=e||64;d=d||[];var p=m.bitArray,f=p.bitLength(b)/8,h=p.bitLength(a),g=p.clamp(a,h-e),l=p.bitSlice(a,
h-e),h=(h-e)/8;7>f&&z(new m.exception.invalid("ccm: iv must be at least 7 bytes"));for(a=2;4>a&&h>>>8*a;a++);a<15-f&&(a=15-f);b=p.clamp(b,8*(15-a));g=m.mode.ccm.p(c,g,b,l,e,a);c=m.mode.ccm.L(c,g.data,b,d,e,a);p.equal(g.tag,c)||z(new m.exception.corrupt("ccm: tag doesn't match"));return g.data},L:function(c,a,b,d,e,p){var f=[],h=m.bitArray,g=h.l;e/=8;(e%2||4>e||16<e)&&z(new m.exception.invalid("ccm: invalid tag length"));(4294967295<d.length||4294967295<a.length)&&z(new m.exception.bug("ccm: can't deal with 4GiB or more data"));
p=[h.partial(8,(d.length?64:0)|e-2<<2|p-1)];p=h.concat(p,b);p[3]|=h.bitLength(a)/8;p=c.encrypt(p);if(d.length)for(b=h.bitLength(d)/8,65279>=b?f=[h.partial(16,b)]:4294967295>=b&&(f=h.concat([h.partial(16,65534)],[b])),f=h.concat(f,d),d=0;d<f.length;d+=4)p=c.encrypt(g(p,f.slice(d,d+4).concat([0,0,0])));for(d=0;d<a.length;d+=4)p=c.encrypt(g(p,a.slice(d,d+4).concat([0,0,0])));return h.clamp(p,8*e)},p:function(c,a,b,d,e,p){var f,h=m.bitArray;f=h.l;var g=a.length,l=h.bitLength(a);b=h.concat([h.partial(8,
p-1)],b).concat([0,0,0]).slice(0,4);d=h.bitSlice(f(d,c.encrypt(b)),0,e);if(!g)return{tag:d,data:[]};for(f=0;f<g;f+=4)b[3]++,e=c.encrypt(b),a[f]^=e[0],a[f+1]^=e[1],a[f+2]^=e[2],a[f+3]^=e[3];return{tag:d,data:h.clamp(a,l)}}};m.mode.ocb2={name:"ocb2",encrypt:function(c,a,b,d,e,p){128!==m.bitArray.bitLength(b)&&z(new m.exception.invalid("ocb iv must be 128 bits"));var f,h=m.mode.ocb2.H,g=m.bitArray,l=g.l,n=[0,0,0,0];b=h(c.encrypt(b));var q,r=[];d=d||[];e=e||64;for(f=0;f+4<a.length;f+=4)q=a.slice(f,f+
4),n=l(n,q),r=r.concat(l(b,c.encrypt(l(b,q)))),b=h(b);q=a.slice(f);a=g.bitLength(q);f=c.encrypt(l(b,[0,0,0,a]));q=g.clamp(l(q.concat([0,0,0]),f),a);n=l(n,l(q.concat([0,0,0]),f));n=c.encrypt(l(n,l(b,h(b))));d.length&&(n=l(n,p?d:m.mode.ocb2.pmac(c,d)));return r.concat(g.concat(q,g.clamp(n,e)))},decrypt:function(c,a,b,d,e,g){128!==m.bitArray.bitLength(b)&&z(new m.exception.invalid("ocb iv must be 128 bits"));e=e||64;var f=m.mode.ocb2.H,h=m.bitArray,l=h.l,n=[0,0,0,0],q=f(c.encrypt(b)),r,s,t=m.bitArray.bitLength(a)-
e,u=[];d=d||[];for(b=0;b+4<t/32;b+=4)r=l(q,c.decrypt(l(q,a.slice(b,b+4)))),n=l(n,r),u=u.concat(r),q=f(q);s=t-32*b;r=c.encrypt(l(q,[0,0,0,s]));r=l(r,h.clamp(a.slice(b),s).concat([0,0,0]));n=l(n,r);n=c.encrypt(l(n,l(q,f(q))));d.length&&(n=l(n,g?d:m.mode.ocb2.pmac(c,d)));h.equal(h.clamp(n,e),h.bitSlice(a,t))||z(new m.exception.corrupt("ocb: tag doesn't match"));return u.concat(h.clamp(r,s))},pmac:function(c,a){var b,d=m.mode.ocb2.H,e=m.bitArray,g=e.l,f=[0,0,0,0],h=c.encrypt([0,0,0,0]),h=g(h,d(d(h)));
for(b=0;b+4<a.length;b+=4)h=d(h),f=g(f,c.encrypt(g(h,a.slice(b,b+4))));b=a.slice(b);128>e.bitLength(b)&&(h=g(h,d(h)),b=e.concat(b,[-2147483648,0,0,0]));f=g(f,b);return c.encrypt(g(d(g(h,d(h))),f))},H:function(c){return[c[0]<<1^c[1]>>>31,c[1]<<1^c[2]>>>31,c[2]<<1^c[3]>>>31,c[3]<<1^135*(c[0]>>>31)]}};m.mode.gcm={name:"gcm",encrypt:function(c,a,b,d,e){var g=a.slice(0);a=m.bitArray;d=d||[];c=m.mode.gcm.p(!0,c,g,d,b,e||128);return a.concat(c.data,c.tag)},decrypt:function(c,a,b,d,e){var g=a.slice(0),f=
m.bitArray,h=f.bitLength(g);e=e||128;d=d||[];e<=h?(a=f.bitSlice(g,h-e),g=f.bitSlice(g,0,h-e)):(a=g,g=[]);c=m.mode.gcm.p(!1,c,g,d,b,e);f.equal(c.tag,a)||z(new m.exception.corrupt("gcm: tag doesn't match"));return c.data},Z:function(c,a){var b,d,e,g,f,h=m.bitArray.l;e=[0,0,0,0];g=a.slice(0);for(b=0;128>b;b++){0!==(c[Math.floor(b/32)]&1<<31-b%32)&&(e=h(e,g));f=0!==(g[3]&1);for(d=3;0<d;d--)g[d]=g[d]>>>1|(g[d-1]&1)<<31;g[0]>>>=1;f&&(g[0]^=-520093696)}return e},g:function(c,a,b){var d,e=b.length;a=a.slice(0);
for(d=0;d<e;d+=4)a[0]^=4294967295&b[d],a[1]^=4294967295&b[d+1],a[2]^=4294967295&b[d+2],a[3]^=4294967295&b[d+3],a=m.mode.gcm.Z(a,c);return a},p:function(c,a,b,d,e,g){var f,h,l,n,q,r,s,t,u=m.bitArray;r=b.length;s=u.bitLength(b);t=u.bitLength(d);h=u.bitLength(e);f=a.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=u.concat(e,[1])):(e=m.mode.gcm.g(f,[0,0,0,0],e),e=m.mode.gcm.g(f,e,[0,0,Math.floor(h/4294967296),h&4294967295]));h=m.mode.gcm.g(f,[0,0,0,0],d);q=e.slice(0);d=h.slice(0);c||(d=m.mode.gcm.g(f,h,b));
for(n=0;n<r;n+=4)q[3]++,l=a.encrypt(q),b[n]^=l[0],b[n+1]^=l[1],b[n+2]^=l[2],b[n+3]^=l[3];b=u.clamp(b,s);c&&(d=m.mode.gcm.g(f,h,b));c=[Math.floor(t/4294967296),t&4294967295,Math.floor(s/4294967296),s&4294967295];d=m.mode.gcm.g(f,d,c);l=a.encrypt(e);d[0]^=l[0];d[1]^=l[1];d[2]^=l[2];d[3]^=l[3];return{tag:u.bitSlice(d,0,g),data:b}}};m.misc.hmac=function(c,a){this.M=a=a||m.hash.sha256;var b=[[],[]],d,e=a.prototype.blockSize/32;this.n=[new a,new a];c.length>e&&(c=a.hash(c));for(d=0;d<e;d++)b[0][d]=c[d]^
909522486,b[1][d]=c[d]^1549556828;this.n[0].update(b[0]);this.n[1].update(b[1]);this.G=new a(this.n[0])};m.misc.hmac.prototype.encrypt=m.misc.hmac.prototype.mac=function(c){this.Q&&z(new m.exception.invalid("encrypt on already updated hmac called!"));this.update(c);return this.digest(c)};m.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]);this.Q=!1};m.misc.hmac.prototype.update=function(c){this.Q=!0;this.G.update(c)};m.misc.hmac.prototype.digest=function(){var c=this.G.finalize(),
c=(new this.M(this.n[1])).update(c).finalize();this.reset();return c};m.misc.pbkdf2=function(c,a,b,d,e){b=b||1E3;(0>d||0>b)&&z(m.exception.invalid("invalid params to pbkdf2"));"string"===typeof c&&(c=m.codec.utf8String.toBits(c));"string"===typeof a&&(a=m.codec.utf8String.toBits(a));e=e||m.misc.hmac;c=new e(c);var g,f,h,l,n=[],q=m.bitArray;for(l=1;32*n.length<(d||1);l++){e=g=c.encrypt(q.concat(a,[l]));for(f=1;f<b;f++)for(g=c.encrypt(g),h=0;h<g.length;h++)e[h]^=g[h];n=n.concat(e)}d&&(n=q.clamp(n,d));
return n};m.prng=function(c){this.c=[new m.hash.sha256];this.i=[0];this.F=0;this.s={};this.C=0;this.K={};this.O=this.d=this.j=this.W=0;this.b=[0,0,0,0,0,0,0,0];this.f=[0,0,0,0];this.A=r;this.B=c;this.q=!1;this.w={progress:{},seeded:{}};this.m=this.V=0;this.t=1;this.u=2;this.S=65536;this.I=[0,48,64,96,128,192,256,384,512,768,1024];this.T=3E4;this.R=80};m.prng.prototype={randomWords:function(c,a){var b=[],d;d=this.isReady(a);var e;d===this.m&&z(new m.exception.notReady("generator isn't seeded"));if(d&
this.u){d=!(d&this.t);e=[];var g=0,f;this.O=e[0]=(new Date).valueOf()+this.T;for(f=0;16>f;f++)e.push(4294967296*Math.random()|0);for(f=0;f<this.c.length&&(e=e.concat(this.c[f].finalize()),g+=this.i[f],this.i[f]=0,d||!(this.F&1<<f));f++);this.F>=1<<this.c.length&&(this.c.push(new m.hash.sha256),this.i.push(0));this.d-=g;g>this.j&&(this.j=g);this.F++;this.b=m.hash.sha256.hash(this.b.concat(e));this.A=new m.cipher.aes(this.b);for(d=0;4>d&&(this.f[d]=this.f[d]+1|0,!this.f[d]);d++);}for(d=0;d<c;d+=4)0===
(d+1)%this.S&&ca(this),e=U(this),b.push(e[0],e[1],e[2],e[3]);ca(this);return b.slice(0,c)},setDefaultParanoia:function(c,a){0===c&&"Setting paranoia\x3d0 will ruin your security; use it only for testing"!==a&&z("Setting paranoia\x3d0 will ruin your security; use it only for testing");this.B=c},addEntropy:function(c,a,b){b=b||"user";var d,e,g=(new Date).valueOf(),f=this.s[b],h=this.isReady(),l=0;d=this.K[b];d===r&&(d=this.K[b]=this.W++);f===r&&(f=this.s[b]=0);this.s[b]=(this.s[b]+1)%this.c.length;
switch(typeof c){case "number":a===r&&(a=1);this.c[f].update([d,this.C++,1,a,g,1,c|0]);break;case "object":b=Object.prototype.toString.call(c);if("[object Uint32Array]"===b){e=[];for(b=0;b<c.length;b++)e.push(c[b]);c=e}else for("[object Array]"!==b&&(l=1),b=0;b<c.length&&!l;b++)"number"!==typeof c[b]&&(l=1);if(!l){if(a===r)for(b=a=0;b<c.length;b++)for(e=c[b];0<e;)a++,e>>>=1;this.c[f].update([d,this.C++,2,a,g,c.length].concat(c))}break;case "string":a===r&&(a=c.length);this.c[f].update([d,this.C++,
3,a,g,c.length]);this.c[f].update(c);break;default:l=1}l&&z(new m.exception.bug("random: addEntropy only supports number, array of numbers or string"));this.i[f]+=a;this.d+=a;h===this.m&&(this.isReady()!==this.m&&ba("seeded",Math.max(this.j,this.d)),ba("progress",this.getProgress()))},isReady:function(c){c=this.I[c!==r?c:this.B];return this.j&&this.j>=c?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=c?this.u|this.m:this.m},getProgress:function(c){c=this.I[c?c:this.B];return this.j>=
c?1:this.d>c?1:this.d/c},startCollectors:function(){this.q||(this.a={loadTimeCollector:Y(this,this.aa),mouseCollector:Y(this,this.ba),keyboardCollector:Y(this,this.$),accelerometerCollector:Y(this,this.U)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1)):document.attachEvent?
(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):z(new m.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",
this.a.accelerometerCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=!1)},addEventListener:function(c,a){this.w[c][this.V++]=a},removeEventListener:function(c,a){var b,d,e=this.w[c],g=[];for(d in e)e.hasOwnProperty(d)&&e[d]===a&&g.push(d);for(b=0;b<g.length;b++)d=g[b],delete e[d]},$:function(){O(1)},ba:function(c){var a,b;try{a=c.x||
c.clientX||c.offsetX||0,b=c.y||c.clientY||c.offsetY||0}catch(d){b=a=0}0!=a&&0!=b&&m.random.addEntropy([a,b],2,"mouse");O(0)},aa:function(){O(2)},U:function(c){c=c.accelerationIncludingGravity.x||c.accelerationIncludingGravity.y||c.accelerationIncludingGravity.z;if(window.orientation){var a=window.orientation;"number"===typeof a&&m.random.addEntropy(a,1,"accelerometer")}c&&m.random.addEntropy(c,2,"accelerometer");O(0)}};m.random=new m.prng(6);a:try{var V,W,X,Z;if(Z="undefined"!==typeof module){var $;
if($=module.exports){var da;try{da=require("crypto")}catch(fa){da=null}$=(W=da)&&W.randomBytes}Z=$}if(Z)V=W.randomBytes(128),V=new Uint32Array((new Uint8Array(V)).buffer),m.random.addEntropy(V,1024,"crypto['randomBytes']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){X=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(X);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(X);else break a;
m.random.addEntropy(X,1024,"crypto['getRandomValues']")}}catch(s){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(s))}m.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(c,a,b,d){b=b||{};d=d||{};var e=m.json,g=e.e({iv:m.random.randomWords(4,0)},e.defaults),f;e.e(g,b);b=g.adata;"string"===typeof g.salt&&(g.salt=m.codec.base64.toBits(g.salt));"string"===typeof g.iv&&(g.iv=m.codec.base64.toBits(g.iv));
(!m.mode[g.mode]||!m.cipher[g.cipher]||"string"===typeof c&&100>=g.iter||64!==g.ts&&96!==g.ts&&128!==g.ts||128!==g.ks&&192!==g.ks&&256!==g.ks||2>g.iv.length||4<g.iv.length)&&z(new m.exception.invalid("json encrypt: invalid parameters"));"string"===typeof c?(f=m.misc.cachedPbkdf2(c,g),c=f.key.slice(0,g.ks/32),g.salt=f.salt):m.ecc&&c instanceof m.ecc.elGamal.publicKey&&(f=c.kem(),g.kemtag=f.tag,c=f.key.slice(0,g.ks/32));"string"===typeof a&&(a=m.codec.utf8String.toBits(a));"string"===typeof b&&(b=m.codec.utf8String.toBits(b));
f=new m.cipher[g.cipher](c);e.e(d,g);d.key=c;g.ct=m.mode[g.mode].encrypt(f,a,g.iv,b,g.ts);return g},encrypt:function(c,a,b,d){var e=m.json,g=e.Y.apply(e,arguments);return e.encode(g)},X:function(c,a,b,d){b=b||{};d=d||{};var e=m.json;a=e.e(e.e(e.e({},e.defaults),a),b,!0);var g,f;g=a.adata;"string"===typeof a.salt&&(a.salt=m.codec.base64.toBits(a.salt));"string"===typeof a.iv&&(a.iv=m.codec.base64.toBits(a.iv));(!m.mode[a.mode]||!m.cipher[a.cipher]||"string"===typeof c&&100>=a.iter||64!==a.ts&&96!==
a.ts&&128!==a.ts||128!==a.ks&&192!==a.ks&&256!==a.ks||!a.iv||2>a.iv.length||4<a.iv.length)&&z(new m.exception.invalid("json decrypt: invalid parameters"));"string"===typeof c?(f=m.misc.cachedPbkdf2(c,a),c=f.key.slice(0,a.ks/32),a.salt=f.salt):m.ecc&&c instanceof m.ecc.elGamal.secretKey&&(c=c.unkem(m.codec.base64.toBits(a.kemtag)).slice(0,a.ks/32));"string"===typeof g&&(g=m.codec.utf8String.toBits(g));f=new m.cipher[a.cipher](c);g=m.mode[a.mode].decrypt(f,a.ct,a.iv,g,a.ts);e.e(d,a);d.key=c;return 1===
b.raw?g:m.codec.utf8String.fromBits(g)},decrypt:function(c,a,b,d){var e=m.json;return e.X(c,e.decode(a),b,d)},encode:function(c){var a,b="{",d="";for(a in c)if(c.hasOwnProperty(a))switch(a.match(/^[a-z0-9]+$/i)||z(new m.exception.invalid("json encode: invalid property name")),b+=d+'"'+a+'":',d=",",typeof c[a]){case "number":case "boolean":b+=c[a];break;case "string":b+='"'+escape(c[a])+'"';break;case "object":b+='"'+m.codec.base64.fromBits(c[a],0)+'"';break;default:z(new m.exception.bug("json encode: unsupported type"))}return b+
"}"},decode:function(c){c=c.replace(/\s/g,"");c.match(/^\{.*\}$/)||z(new m.exception.invalid("json decode: this isn't json!"));c=c.replace(/^\{|\}$/g,"").split(/,/);var a={},b,d;for(b=0;b<c.length;b++)(d=c[b].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))||z(new m.exception.invalid("json decode: this isn't json!")),a[d[2]]=d[3]?parseInt(d[3],10):d[2].match(/^(ct|salt|iv)$/)?m.codec.base64.toBits(d[4]):unescape(d[4]);return a},e:function(c,a,b){c===r&&(c={});if(a===r)return c;
for(var d in a)a.hasOwnProperty(d)&&(b&&c[d]!==r&&c[d]!==a[d]&&z(new m.exception.invalid("required parameter overridden")),c[d]=a[d]);return c},ea:function(c,a){var b={},d;for(d in c)c.hasOwnProperty(d)&&c[d]!==a[d]&&(b[d]=c[d]);return b},da:function(c,a){var b={},d;for(d=0;d<a.length;d++)c[a[d]]!==r&&(b[a[d]]=c[a[d]]);return b}};m.encrypt=m.json.encrypt;m.decrypt=m.json.decrypt;m.misc.ca={};m.misc.cachedPbkdf2=function(c,a){var b=m.misc.ca,d;a=a||{};d=a.iter||1E3;b=b[c]=b[c]||{};d=b[d]=b[d]||{firstSalt:a.salt&&
a.salt.length?a.salt.slice(0):m.random.randomWords(2,0)};b=a.salt===r?d.firstSalt:a.salt;d[b]=d[b]||m.misc.pbkdf2(c,b,a.iter);return{key:d[b].slice(0),salt:b.slice(0)}};E=window.drwp=window.drwp||{};E=E.encrypt=E.encrypt||{createPaymentForm:function(c,a){return new L(c,a)}};E.errors=E.errors||{};var L=E.PaymentForm=function(c,a){try{m.random.startCollectors()}catch(b){console.log("cannot start sjcl random")}this.key=c;this.drCompanyId=a;this.validity={}};L.prototype={constructor:L,createRSAKey:function(){var c=
this.key.split("|");if(2!=c.length)throw"Malformed public key";var a=c[0],c=c[1],b=new e;b.setPublic(c,a);return b},createAESKey:function(){return new D},encryptPaymentForm:function(c){var a,b,d={};a=this.createRSAKey();b=this.createAESKey();d=b.encrypt(c);keybytes=m.codec.base64url.fromBits(b.key);c=a.encrypt(keybytes);return["DRWP_1.0#",this.drCompanyId,"#",c,"#",d.iv,"#",d.cipher].join("")}};var D=function(){},P={cipher:null,iv:null};D.prototype={constructor:D,key:m.random.randomWords(8,0),encrypt:function(c){return this.encryptWithInitializationVector(c,
m.random.randomWords(4,0))},encryptWithInitializationVector:function(c,a){var b,d;b=new m.cipher.aes(this.key);d=m.codec.utf8String.toBits(c);b=m.mode.gcm.encrypt(b,d,a);P.cipher=m.codec.base64url.fromBits(b);P.iv=m.codec.base64url.fromBits(a);return P}}})();function AdyenEncrypter(e,g,n,q,t){this._instance=e.createEncryption(g);this._instance.monitor("number",q);this._instance.monitor("cvc",t);this._holderFullname=n}
AdyenEncrypter.prototype.encrypt=function(e){return this._instance.encrypt({number:e.number,cvc:e.cvc,expiryMonth:e.expiryMonth,expiryYear:e.expiryYear,holderName:this._holderFullname,generationtime:e.generationtime})};function DigitalRiverEncrypter(e,g,n,q,t){this._instance=e.createPaymentForm(g,n);this._holderFullname=q+" "+t;this._holderFirstname=q;this._holderLastname=t}
DigitalRiverEncrypter.prototype.encrypt=function(e){return this._instance.encryptPaymentForm(JSON.stringify({cardNumber:e.number,expirationYear:e.expiryYear,expirationMonth:e.expiryMonth,cvCode:e.cvc,fullName:this._holderFullname,firstName:this._holderFirstname,lastName:this._holderLastname}))};function CSE(e){this._providerEncrypterMapping=e}CSE.prototype.encrypt=function(e,g){if(!this._providerEncrypterMapping[e])throw"Unsupported provider: "+e;return this._providerEncrypterMapping[e].encrypt(g)};
function CardStore(){this._allowedBinNos=[]}CardStore.ERR_INVALID=-1;CardStore.ERR_LENGTH=-2;CardStore.ERR_UNKNOWN_CARD=-3;CardStore.ERR_BIN_BLOCKED=-4;CardStore.VALID=1;CardStore.MAX_BIN_LENGTH=8;CardStore.DEFAULT_CARD_FORMAT=[4,4,4,4];CardStore.DEFAULT_CARD_LENGTH=16;CardStore.DEFAULT_CVC_LENGTH=3;
CardStore.CARDS=[{type:"visa",pattern:/^4/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"mastercard",pattern:/^(5[1-5]|222[1-9]|2[3-6]\d{2}|27[0-1]\d|2720)/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"amex",pattern:/^3[47]/,length:15,format:[4,6,5],cvc:4},{type:"discover",pattern:/^6(?:011\d{12}|5\d{14}|4[4-9]\d{13}|22(?:1(?:2[6-9]|[3-9]\d)|[2-8]\d{2}|9(?:[01]\d|2[0-5]))\d{10})/,
length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"hiper",pattern:/^606282|384100|384140|384160/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"diners",pattern:/^(300|301|302|303|304|305|36|38)/,length:14,format:[4,6,4],cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"jcb_15",pattern:/^2131|1800/,length:15,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},
{type:"jcb_16",pattern:/^35(?:2[89]|[3-8]\d)/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"elo",pattern:/^(36297|4011|4576|438935|451416|438935|457631|457632|5066|5067|50900|504175|506699|627780|636297|636368|636505)/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"aura",pattern:/^((?!5066|5067|50900|504175|506699)50)/,length:19,format:[19],cvc:CardStore.DEFAULT_CVC_LENGTH}];
CardStore.prototype.getByNumber=function(e){e=e.replace(/\D/g,"");for(var g=0;g<CardStore.CARDS.length;g++){var n=CardStore.CARDS[g];if(n.pattern.test(e))return n}return null};CardStore.prototype.isValidCvcForCardNumber=function(e,g){if(/^[0-9]*$/.test(e)){var n=this.getByNumber(g);return e.length===(n?n.cvc:CardStore.DEFAULT_CVC_LENGTH)}return!1};CardStore.prototype.setBinNos=function(e){this._allowedBinNos=e.map(function(e){return String(e).substr(0,CardStore.MAX_BIN_LENGTH)})};
CardStore.prototype._isValidBinNo=function(e){return 0===this._allowedBinNos.length||this._allowedBinNos.some(function(g){return 0===e.indexOf(g)},this)};CardStore.prototype.validateNumber=function(e){if(!e)return CardStore.ERR_LENGTH;e=e.replace(/ /g,"");var g=this.getByNumber(e);return g&&g.length===e.length?this._isValidBinNo(e)?this._luhnCheck(e)?CardStore.VALID:CardStore.ERR_INVALID:CardStore.ERR_BIN_BLOCKED:CardStore.ERR_UNKNOWN_CARD};
CardStore.prototype._luhnCheck=function(e){for(var g=0,n=0,q=e.length-1;0<=q;q--){n+=parseInt(e.charAt(q),10);q--;for(var g=String(2*e.charAt(q)),t=0;t<g.length;t++)n+=parseInt(g.charAt(t),10)}return 0==n%10};function CardNumberInput(e,g,n,q){this._el=e;this._cardStore=g;this._cvcInput=n;this._iconSelector=q;this._currentCard=this._createDefaultCard()}
CardNumberInput.prototype.attach=function(){this._el.addEventListener("input",this._onInput.bind(this));this._el.addEventListener("change",this._onInput.bind(this));this._el.addEventListener("keydown",this._handleBackspace.bind(this));this._el.addEventListener("keypress",this._onKeyPress.bind(this),!1)};CardNumberInput.prototype._createDefaultCard=function(){return{type:!1,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH}};
CardNumberInput.prototype._getCardByNumber=function(e){return this._cardStore.getByNumber(e)||this._createDefaultCard()};CardNumberInput.prototype._setCurrentCard=function(e){e.type!==this._currentCard.type&&(this._cvcInput.resetMaxLength(e.cvc),this._iconSelector.highlightIcon(e.type),this._currentCard=e)};
CardNumberInput.prototype._onKeyPress=function(e){var g=e.currentTarget,n=String.fromCharCode(e.which||e.charCode||e.keyCode),q=g.value;if(/^\d+$/.test(n)&&!/\s$/.test(q)&&this._isCursorAtEnd(g)){var t=(q.replace(/\D/g,"")+n).length,F=this._getCardByNumber(q+n);t!==F.length&&(t>F.length?e.preventDefault():(F=this._getCutOffs(F.format),-1<F.indexOf(t)?(e.preventDefault(),g.value=q+n+" "):-1<F.indexOf(t-1)&&(e.preventDefault(),g.value=q+" "+n)))}};
CardNumberInput.prototype._onInput=function(){var e=this._el.value.replace(/\D/g,""),g=this._getCardByNumber(e);this._setCurrentCard(g);var n=this._el;this._isCursorAtEnd()&&setTimeout(function(){n.selectionStart=n.selectionEnd=1E4},0);this._el.value=this._formatCardNumber(e,g)};
CardNumberInput.prototype._formatCardNumber=function(e,g){var n=this._createRegExpFromFormat(g.format),q=e.substring(0,g.length),n=n.exec(q);null!=n&&(n.shift(),q=n.filter(function(e){return"string"===typeof e}).join(" "));return q};CardNumberInput.prototype._handleBackspace=function(e){if(8===(e.which||e.keyCode||e.charCode)&&this._isCursorAtEnd()){var g=/\d\s$/;g.test(this._el.value)&&(e.preventDefault(),this._el.value=this._el.value.replace(g,""))}};
CardNumberInput.prototype._getCutOffs=function(e){return e.reduce(function(e,n,q){e.push(0<q?n+e[q-1]:n);return e},[]).slice(0,-1)};CardNumberInput.prototype._createRegExpFromFormat=function(e){e=e.map(function(e){return"(\\d{1,"+e+"})"});e=e[0]+e.slice(1).join("?")+"?";return new RegExp(e)};CardNumberInput.prototype._isCursorAtEnd=function(){return this._el.selectionStart===this._el.value.length};function ExpiryDateInput(e){this._el=e}
ExpiryDateInput.prototype.attach=function(){this._el.addEventListener("keydown",this._handleBackspace.bind(this));this._el.addEventListener("input",this._onInput.bind(this))};ExpiryDateInput.prototype._onInput=function(){var e=this._el;this._isCursorAtEnd()&&setTimeout(function(){e.selectionStart=e.selectionEnd=1E4},0);this._el.value=this._format(this._el.value)};
ExpiryDateInput.prototype._handleBackspace=function(e){if(8===(e.which||e.keyCode||e.charCode)&&this._isCursorAtEnd()){var g=/\d\s\/\s$/;g.test(this._el.value)&&(e.preventDefault(),this._el.value=this._el.value.replace(g,""))}};
ExpiryDateInput.prototype._format=function(e){var g=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,2})?/);if(null===g)return"";e=g[1]||"";var n=g[2]||"",g=g[3]||"";0<g.length&&(n=" / ");" /"===n?n="":2===e.length?12>=parseInt(e,10)?n=" / ":e=e.substring(0,1):-1===["0","1"].indexOf(e)?(e="0"+e,n=" / "):n.length&&1===e.length&&(e="0"+e,n=" / ");return e+n+g};ExpiryDateInput.prototype._isCursorAtEnd=function(){return this._el.selectionStart===this._el.value.length};
function CvcInput(e){this._el=e;this._maxLength=3}CvcInput.prototype.attach=function(){this._el.addEventListener("input",this._format.bind(this))};CvcInput.prototype.resetMaxLength=function(e){this._maxLength=e;this._format()};CvcInput.prototype._format=function(){this._el.value=this._el.value.replace(/\D/g,"").substring(0,this._maxLength)};function PostalCodeInput(e){this._el=e}PostalCodeInput.MAX_LENGTH=10;PostalCodeInput.prototype.attach=function(){this._el.addEventListener("input",this._format.bind(this))};
PostalCodeInput.prototype._format=function(){this._el.value=this._el.value.replace(/ /g,"").substring(0,PostalCodeInput.MAX_LENGTH)};var IconSelector=function(e,g){this._iconContainer=e;this._disabledClass=g;this._iconList=[];this._isSet=!1};
IconSelector.prototype.populateList=function(e){if(this._iconContainer&&!this._isSet){this._isSet=!0;var g=document.createDocumentFragment(),n;for(n in e)if(e.hasOwnProperty(n)){var q=document.createElement("span");q.className="icon-provider "+e[n];q.className+=" disabled";g.appendChild(q)}this._iconContainer.appendChild(g);this._iconList=this._getIconList()}};
IconSelector.prototype.highlightIcon=function(e){for(var g=0;g<this._iconList.length;g++){var n=this._iconList[g],q=n.className.split(" "),t=q.indexOf(this._disabledClass);n.getAttribute("data-type")===e?-1<t&&q.splice(t):-1===t&&q.push(this._disabledClass);n.className=q.join(" ")}};
IconSelector.prototype._getIconList=function(){for(var e=[],g=this._iconContainer.getElementsByTagName("span"),n=0;n<g.length;n++){var q=g[n].className.split(" ");-1<q.indexOf("icon-provider")&&(g[n].setAttribute("data-type","undefined"!==typeof q[1]?q[1]:""),e.push(g[n]))}return e};var FieldParser=function(e){this._form=e;this._fieldMap=null};FieldParser.prototype.getFieldMap=function(){this._fieldMap||(this._fieldMap=this._setupFields());return this._fieldMap};
FieldParser.prototype._setupFields=function(){return[].slice.call(this._form.getElementsByTagName("input")).concat([].slice.call(this._form.getElementsByTagName("select"))).reduce(function(e,g){var n=g.hasAttribute("data-encrypted-name")?g.getAttribute("data-encrypted-name"):g.getAttribute("name");e[n]=g;return e},{})};var FormValidator=function(e,g,n){this._cardStore=e;this._fieldMap=g;this._sender=n};
FormValidator.prototype.validateForm=function(){var e=!0,g;for(g in this._fieldMap)if(this._fieldMap.hasOwnProperty(g)){var n=this._fieldMap[g].value,q=null;switch(g){case "number":q=this._getCardError(n);break;case "expiryMonth":q=this._isEmptyError(n,"invalid_mm");break;case "expiryYear":q=this._isEmptyError(n,"invalid_yy");break;case "expiryDate":q=this._validateExpiryDate(n);break;case "cvc":q=this._validateCvc(n,this._fieldMap.number?this._fieldMap.number.value:"");break;case "zip-code":q=this._validateZipCode(n)}null===
q?n={route:"hideError",data:{errorType:g}}:(e=!1,n={route:"showError",data:{errorType:g,msg:q,useTranslator:!0}});this._sender.send(n)}return e};FormValidator.prototype.attach=function(){var e=this;e._fieldMap.number&&e._fieldMap.number.addEventListener("keyup",function(g){g=e._cardStore.validateNumber(g.target.value)!==CardStore.ERR_INVALID?{route:"hideError",data:{errorType:"number"}}:{route:"showError",data:{errorType:"number",msg:"invalid_creditcard",useTranslator:!0}};e._sender.send(g)},!1)};
FormValidator.prototype.removeField=function(e){this._fieldMap.hasOwnProperty(e)&&delete this._fieldMap[e]};FormValidator.prototype._getCardError=function(e){switch(this._cardStore.validateNumber(e)){case CardStore.VALID:return null;case CardStore.ERR_BIN_BLOCKED:return"bin_blocked";default:return"invalid_creditcard"}};FormValidator.prototype._isEmptyError=function(e,g){return""===e?g:null};
FormValidator.prototype._validateCvc=function(e,g){return this._cardStore.isValidCvcForCardNumber(e,g)?null:"invalid_cvc"};FormValidator.prototype._validateExpiryDate=function(e){e=e.replace(/ /g,"");return/^(1[0-2]|0[1-9]|[1-9])\/\d\d$/.test(e)?null:"invalid_expiry_date"};FormValidator.prototype._validateZipCode=function(e){return/(^\w{3,}$)/.test(e.replace(/[ -]+/g,""))?null:"invalid_zipcode"};var Resizer=function(e,g){this._window=e;this._sender=g;this._height=0;this._body=this._window.document.body};
Resizer.prototype.sendHeightToParent=function(){this._height=this._getHeight();this._sendMessage()};Resizer.prototype._getHeight=function(){return this._body.clientHeight};Resizer.prototype._sendMessage=function(){this._sender.send({route:"resize",data:{height:this._height}})};var HoverHandler=function(e,g,n,q){this._elements=e;this._timeout=g;this._window=n;this._sender=q;this._timer=this._currentTarget=null};
HoverHandler.prototype.attach=function(){for(var e=0;e<this._elements.length;e++)this._elements[e].addEventListener("mouseover",this._startHover.bind(this)),this._elements[e].addEventListener("touchstart",this._startHover.bind(this)),this._elements[e].addEventListener("mouseleave",this._endHover.bind(this)),this._elements[e].addEventListener("touchend",this._endHover.bind(this))};
HoverHandler.prototype._startHover=function(e){this._currentTarget!==e.target&&(this._currentTarget=e.target,this._timer=this._window.setTimeout(this._messageShow.bind(this),this._timeout))};HoverHandler.prototype._endHover=function(e){null!==this._currentTarget&&(this._currentTarget=null,clearTimeout(this._timer),this._messageHide())};HoverHandler.prototype._messageShow=function(){this._sender.send({route:"showTooltip",data:{key:this._currentTarget.getAttribute("data-lang"),offset:this._getOffset(this._currentTarget)}})};
HoverHandler.prototype._messageHide=function(){this._sender.send({route:"hideTooltip",data:{}})};HoverHandler.prototype._getOffset=function(e){for(var g={w:e.clientWidth,h:e.clientHeight},n=0,q=0;e;)n+=e.offsetLeft,q+=e.offsetTop,e=e.offsetParent;g.x=n;g.y=q;return g};var MsgSender=function(e,g){this._parent=e;this._domainWhitelist=g instanceof Array?g:null;this._broadcastDomain=null};
MsgSender.prototype.send=function(e){if(!this._broadcastDomain)return!1;e=JSON.stringify(e);this._parent.postMessage(e,this._broadcastDomain);return!0};MsgSender.prototype.setBroadcastDomain=function(e){this._domainWhitelist&&0>this._domainWhitelist.indexOf("*")&&0>this._domainWhitelist.indexOf(e)||(this._broadcastDomain=e)};var Translator=function(){this._translations=null;this._isSet=!1};Translator.TRANS_KEY="trans-";Translator.prototype.setTranslations=function(e){this._translations=e};
Translator.prototype.injectTranslations=function(){if(!this._isSet){this._isSet=!0;for(var e in this._translations)if(this._translations.hasOwnProperty(e)){var g=document.getElementById(Translator.TRANS_KEY+e);g&&g.appendChild(document.createTextNode(this._translations[e]))}}};var YearSelect=function(e){this._el=e};YearSelect.YEARS=30;
YearSelect.prototype.create=function(){if(this._el){for(var e=this._el,g=document.createDocumentFragment(),n=(new Date).getFullYear(),q=0;q<YearSelect.YEARS;q++){var t=document.createElement("option");t.setAttribute("value",n+q);t.appendChild(document.createTextNode((n+q).toString().substr(2)));g.appendChild(t)}e.appendChild(g)}};var Submitter=function(e,g,n,q,t){this._validator=e;this._fieldMap=g;this._cse=n;this._sender=q;this._zipCode=t};
Submitter.prototype.handlePost=function(e){if(this._validator.validateForm()){e={success:!0,token:this._cse.encrypt(e,this._getData())};var g=this._zipCode;!1===g.disabled&&(e.zipcode=g.value);this._sender.send({route:"proceed",data:e})}};
Submitter.prototype._getData=function(){var e,g;this._fieldMap.expiryDate?(g=this._parseExpiryDate(this._fieldMap.expiryDate.value),e=g[0],g=g[1]):(e=this._fieldMap.expiryMonth.value,g=this._fieldMap.expiryYear.value);return{number:this._fieldMap.number.value,cvc:this._fieldMap.cvc.value,expiryMonth:e,expiryYear:g,generationtime:this._fieldMap.generationtime.value}};
Submitter.prototype._parseExpiryDate=function(e){var g=e.replace(/ /g,"").split("/");e=parseInt(g[0],10).toString();g=Math.floor((new Date).getFullYear()/100)+g[1];return[e,g]};var CssAttacher=function(e,g){this._window=e;this._cssOrigin=g};CssAttacher.FALLBACK_DETECT_DELAY=1E3;CssAttacher.FALLBACK_DETECT_INTERVAL=100;CssAttacher.prototype.addCss=function(e,g){if(e instanceof Array){var n=e.filter(this._validateCssOrigin.bind(this)).map(this._createStyleSheet.bind(this));this._loadStyleSheets(n,g)}};
CssAttacher.prototype._createStyleSheet=function(e){var g=this._window.document.createElement("link");g.type="text/css";g.rel="stylesheet";g.href=e;return g};
CssAttacher.prototype._loadStyleSheets=function(e,g){function n(){F+=1;F===t&&q()}for(var q=function(){var e=!1;return function(){e||(e=!0,g())}}(),t=e.length,F=0,K=this._window.document.getElementsByTagName("head")[0],H=0;H<t;H++)e[H].addEventListener("load",n),K.appendChild(e[H]);this._window.setTimeout(function(){0===F&&this._startFallbackOnloadDetect(e,q)}.bind(this),CssAttacher.FALLBACK_DETECT_DELAY)};
CssAttacher.prototype._startFallbackOnloadDetect=function(e,g){var n=e.map(function(e){return e.href}),q=[].slice.call(this._window.document.styleSheets).filter(function(e){return-1<n.indexOf(e.href)});if(n.length===q.length)return g();this._window.setTimeout(this._startFallbackOnloadDetect.bind(this,e,g),CssAttacher.FALLBACK_DETECT_INTERVAL)};CssAttacher.prototype._validateCssOrigin=function(e){if(!e)return!1;e=this._getDomain(e);return(new RegExp(this._cssOrigin)).test(e)};
CssAttacher.prototype._getDomain=function(e){var g=this._window.document.createElement("a");g.href=e;return["https://",g.hostname].join("")};var DomInteractor=function(e,g){this._documentNode=e;this._validator=g;this._isGenTimeSet=this._isPostalSet=!1};
DomInteractor.prototype.setPostal=function(e){if(!this._isPostalSet){this._isPostalSet=!0;var g=this._documentNode.getElementById("zip-code"),n=this._documentNode.getElementById("trans-label_postal_code");e.hasOwnProperty("require")&&e.hasOwnProperty("postal_code")?e.require?g.value=e.postal_code:this._hidePostalCode(g,n):this._hidePostalCode(g,n)}};
DomInteractor.prototype.setGenTime=function(e){this._isGenTimeSet||(this._isGenTimeSet=!0,this._documentNode.getElementById("generation-time").value=e)};DomInteractor.prototype._hidePostalCode=function(e,g){e.style.display="none";e.disabled=!0;g.style.display="none";this._validator.removeField("zip-code")};
var Router=function(e,g,n,q,t,F,K,H,I,G,J){this._window=e;this._submitter=g;this._validator=n;this._translator=q;this._iconSelector=t;this._resizer=F;this._domInteractor=K;this._cssAttacher=H;this._sender=I;this._cardStore=G;this._listenOrigin=J;var M=this;this._window.addEventListener("message",function(e){M._msgListener(e,!1)},!1)};
Router.prototype._msgListener=function(e){if(this._checkOrigin(e.origin)&&(e=e.data,e=JSON.parse(e),this._validateMessage(e)))switch(e.route){case "setDomain":this._sender.setBroadcastDomain(e.data);this._sender.send({route:"load",data:{}});break;case "submit":this._submitter.handlePost(e.data.provider);break;case "configure":this._cssAttacher.addCss(e.data.css,this._sendDisplayMessage.bind(this));this._translator.setTranslations(e.data.translations);this._translator.injectTranslations();this._iconSelector.populateList(e.data.icons);
this._domInteractor.setPostal(e.data.postal);this._domInteractor.setGenTime(e.data.genTime);e.data.bins&&this._cardStore.setBinNos(e.data.bins);break;case "getHeight":this._resizer.sendHeightToParent()}};Router.prototype._sendDisplayMessage=function(){this._sender.send({route:"display",data:{}})};Router.prototype._checkOrigin=function(e){return(new RegExp(this._listenOrigin)).test(e)};Router.prototype._validateMessage=function(e){return e instanceof Object&&e.hasOwnProperty("route")&&e.hasOwnProperty("data")};
(function(){var e=document.getElementById("payment-form"),g=new MsgSender(window.parent,["https://www.spotify.com","https://www-staging.spotify.com","https://www-staging3.spotify.com"]),n=(new FieldParser(e)).getFieldMap(),e=new CardStore,q=new IconSelector(document.getElementById("provider-icons"),"disabled"),t=new FormValidator(e,n,g),F=new Resizer(window,g),K=new CvcInput(n.cvc),H=new CardNumberInput(n.number,e,K,q),I=new PostalCodeInput(n["zip-code"]),G=null;n.expiryDate&&(G=new ExpiryDateInput(n.expiryDate));
var J=new HoverHandler(document.querySelectorAll(".tooltip, [data-tooltip]"),100,window,g),M=new YearSelect(document.getElementById("expiry-year")),T=new DomInteractor(document,t),z=new CssAttacher(window,"(^https://www\\.scdn\\.co$)"),N=new Translator,x={};x.adyen=new AdyenEncrypter(adyen.encrypt,"10001|BD3CE0C63C52704C4A8D9263E227D9A4122862A44300645B8AD5CC6401597BB711C87C962FAED958209F8D6AF9E2D64C330C7C295CB77ABC70C0B1857A54AC84AC9CFDF895A55507A3B47BD940EEAB7B96C2D147D4D96933792B1667DEA36C54F43B8381E64210FB4665B04131292164A1C82E24F7D0E61ADD122DCF648F31D9B6BFC14BB27F6A7975F9604A1A3AC8D940A139E4BFD397522EC9DC7B717A616A4F02DC8FBD4E3A2D9861F3C87B5712D525B899BB7619DD49A359E07A890D5FC1FAA56F23FD6CCD31EDB835DF4338F568B8DEB04698572CCA0960D466F89F72A2A47254583208723DD6FFC7278E347BABB6132124207D27CAF2954A98952C8ADB",
"Spotify User",n.number,n.cvc);x.digitalriver=new DigitalRiverEncrypter(drwp.encrypt,"10001|aa0a38ecae66195a1f90355e36ade9c093131a4de0fbfef90c377d6c879c2db42a6f6226c76162a88cc2adf1c89b759bd89c2e1083044f6c3fae0b3c331962725fbdde037ef242566f7c02e21f24fc09e3f65930e2b4ba5ef09f6eef02d89278d9d38ac10f4af65a32d0c79406eb212358149aa4cc8f1a18772c68983917b2292d62b01d526ceb01c4a28e849ecc51b241f11a830479adc778ded5c64f18f94bb8378f0f45bbd31cc9f791cd1bc612f4d15e3c2b16560e30d0e6a517c41f90558541e6b5cca779ce4e47f07d58926d1c40fdc2e3725772035f8cc9b8703dc11bc705fda493cd9a0dc208f7ad24c9201c1da6d365e0749ce0ece74e132c297b0d",
"spotify","Spotify","User");x=new CSE(x);n=new Submitter(t,n,x,g,document.getElementById("zip-code"));new Router(window,n,t,N,q,F,T,z,g,e,"(^https://www\\.spotify\\.com$|^https://www-staging\\.spotify\\.com|^https://www-staging3\\.spotify\\.com$)");window.addEventListener("load",function(){M.create();t.attach();J.attach();K.attach();H.attach();I.attach();G&&G.attach()});g=new MsgSender(window.parent);g.setBroadcastDomain("*");g.send({route:"ping"})})();